<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Hidden Markov Model (HMM) Bootstrap for Multivariate Time Series — hmm_bootstrap • tsbs</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hidden Markov Model (HMM) Bootstrap for Multivariate Time Series — hmm_bootstrap"><meta name="description" content="Fits a Gaussian Hidden Markov Model (HMM) to a multivariate time series
and generates bootstrap replicates by resampling regime-specific blocks."><meta property="og:description" content="Fits a Gaussian Hidden Markov Model (HMM) to a multivariate time series
and generates bootstrap replicates by resampling regime-specific blocks."><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tsbs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/bootstrap_diagnostics.html">Bootstrap Diagnostics Guide</a></li>
    <li><a class="dropdown-item" href="../articles/cgarch_vs_dcc.html">Copula GARCH vs DCC: Model Comparison and Diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/dcc_inference_guide.html">DCC Parameter Inference Guide</a></li>
    <li><a class="dropdown-item" href="../articles/ms-varma-garch_diagnostics.html">Diagnostic System for MS-VARMA-GARCH Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/ms-varma-garch_inference.html">MS-VARMA-GARCH Parameter Inference Guide</a></li>
    <li><a class="dropdown-item" href="../articles/multivariate_garch_comparison.html">Multivariate GARCH Model Comparison: DCC, CGARCH, and GOGARCH</a></li>
    <li><a class="dropdown-item" href="../articles/portfolio-optimization-demo.html">Portfolio Optimization with Multivariate GARCH Model Comparison</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Hidden Markov Model (HMM) Bootstrap for Multivariate Time Series</h1>

      <div class="d-none name"><code>hmm_bootstrap.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a Gaussian Hidden Markov Model (HMM) to a multivariate time series
and generates bootstrap replicates by resampling regime-specific blocks.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">hmm_bootstrap</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  n_boot <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  num_blocks <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_boots <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  parallel <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  num_cores <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  return_fit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  collect_diagnostics <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Numeric vector or matrix representing the time series.</p></dd>


<dt id="arg-n-boot">n_boot<a class="anchor" aria-label="anchor" href="#arg-n-boot"></a></dt>
<dd><p>Length of bootstrap series.</p></dd>


<dt id="arg-num-states">num_states<a class="anchor" aria-label="anchor" href="#arg-num-states"></a></dt>
<dd><p>Integer number of hidden states for the HMM.</p></dd>


<dt id="arg-num-blocks">num_blocks<a class="anchor" aria-label="anchor" href="#arg-num-blocks"></a></dt>
<dd><p>Integer number of blocks to sample for each bootstrap
replicate.</p></dd>


<dt id="arg-num-boots">num_boots<a class="anchor" aria-label="anchor" href="#arg-num-boots"></a></dt>
<dd><p>Integer number of bootstrap replicates to generate.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>Parallelize computation? <code>TRUE</code> or <code>FALSE</code>.</p></dd>


<dt id="arg-num-cores">num_cores<a class="anchor" aria-label="anchor" href="#arg-num-cores"></a></dt>
<dd><p>Number of cores.</p></dd>


<dt id="arg-return-fit">return_fit<a class="anchor" aria-label="anchor" href="#arg-return-fit"></a></dt>
<dd><p>Logical. If TRUE, returns the fitted HMM model along with
bootstrap samples. Default is FALSE.</p></dd>


<dt id="arg-collect-diagnostics">collect_diagnostics<a class="anchor" aria-label="anchor" href="#arg-collect-diagnostics"></a></dt>
<dd><p>Logical. If TRUE, collects detailed diagnostic
information including regime composition of each bootstrap replicate.
Default is FALSE.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If TRUE, prints HMM fitting information and warnings.
Defaults to FALSE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>If <code>return_fit = FALSE</code> and <code>collect_diagnostics = FALSE</code>:
A list of bootstrap replicate matrices.</p>
<p>If <code>return_fit = TRUE</code> or <code>collect_diagnostics = TRUE</code>:
A list containing:</p><dl><dt>bootstrap_series</dt>
<dd><p>List of bootstrap replicate matrices</p></dd>

<dt>fit</dt>
<dd><p>(if return_fit = TRUE) The fitted depmixS4 model object</p></dd>

<dt>states</dt>
<dd><p>The Viterbi state sequence for the original data</p></dd>

<dt>diagnostics</dt>
<dd><p>(if collect_diagnostics = TRUE) A tsbs_diagnostics object</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function:</p><ul><li><p>Fits a Gaussian HMM to <code>x</code> using <code><a href="https://rdrr.io/pkg/depmixS4/man/depmix.html" class="external-link">depmixS4::depmix()</a></code> and
<code><a href="https://rdrr.io/pkg/depmixS4/man/depmix.fit.html" class="external-link">depmixS4::fit()</a></code>.</p></li>
<li><p>Uses Viterbi decoding (<code>posterior(fit, type = "viterbi")$state</code>)
to assign each observation to a state.</p></li>
<li><p>Samples contiguous blocks of observations belonging to each state.</p></li>
</ul><p>If <code>n_boot</code> is set, the last block will be trimmed when necessary.
If <code>n_boot</code> is not set, and <code>num_blocks</code> is set, the length of each
bootstrap series will be determined by the number of blocks and the random
lengths of the individual blocks for that particular series.
If neither <code>n_boot</code> nor <code>num_blocks</code> is set, <code>n_boot</code> will default to the
number of rows in <code>x</code> and the last block will be trimmed when necessary.</p>
<p>For multivariate series (matrices or data frames), the function fits a single
HMM where all variables are assumed to depend on the same underlying hidden
state sequence. The returned bootstrap samples are matrices with the same
number of columns as the input <code>x</code>.</p>
<p>Hidden Markov Model definition:</p><ul><li><p>\(T\): sequence length</p></li>
<li><p>\(K\): number of hidden states</p></li>
<li><p>\(\mathbf{X} = (X_1, \dots, X_T)\): observed sequence</p></li>
<li><p>\(\mathbf{S} = (S_1, \dots, S_T)\): hidden (latent) state sequence</p></li>
<li><p>\(\pi_i = \mathbb{P}(S_1 = i)\): initial state distribution</p></li>
<li><p>\(A = [a_{ij}], \text{ where } a_{ij} = \mathbb{P}(S_{t+1} = j \mid S_t = i)\): transition matrix</p></li>
<li><p>\(b_j(x_t) = \mathbb{P}(X_t = x_t \mid S_t = j)\): output probability</p></li>
</ul><p>Joint probability of the observations and the hidden states:</p>
<p>\(\mathbb{P}(\mathbf{X}, \mathbf{S}) = \pi_{S_1} b_{S_1}(X_1) \prod_{t=2}^{T} a_{S_{t-1} S_t} b_{S_t}(X_t)\)</p>
<p>Marginal probability of the observed data is obtained by summing over all
possible hidden state sequences:</p>
<p>\(\mathbb{P}(\mathbf{X}) = \sum_{\mathbf{S}} \mathbb{P}(\mathbf{X}, \mathbf{S})\)</p>
<p>(Beware of the "double use of data" problem: The bootstrap procedure relies
on regime classification, but the regimes themselves are estimated from the
same data and depend on the parameters being resampled.)</p>
<p>When <code>collect_diagnostics = TRUE</code>, the function records:</p><ul><li><p>Original state sequence from Viterbi decoding</p></li>
<li><p>State sequence for each bootstrap replicate</p></li>
<li><p>Block information (lengths, source positions)</p></li>
</ul><p>This information can be used with <code><a href="plot_regime_composition.html">plot_regime_composition()</a></code> to visualize
how the bootstrap samples are composed from different regimes.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Holst, U., Lindgren, G., Holst, J. and Thuvesholmen, M. (1994), Recursive
Estimation In Switching Autoregressions With A Markov Regime. Journal of
Time Series Analysis, 15: 489-506.
<a href="https://doi.org/10.1111/j.1467-9892.1994.tb00206.x" class="external-link">https://doi.org/10.1111/j.1467-9892.1994.tb00206.x</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># Requires depmixS4 package</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"depmixS4"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">## Example 1: Univariate time series with regime switching</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Generate data with two regimes</span></span></span>
<span class="r-in"><span>  <span class="va">n1</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>  <span class="va">n2</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>  <span class="va">regime1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n1</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">regime2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n2</span>, mean <span class="op">=</span> <span class="fl">5</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x_univar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">regime1</span>, <span class="va">regime2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Generate bootstrap samples</span></span></span>
<span class="r-in"><span>  <span class="va">boot_samples</span> <span class="op">&lt;-</span> <span class="fu">hmm_bootstrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">x_univar</span>,</span></span>
<span class="r-in"><span>    n_boot <span class="op">=</span> <span class="fl">150</span>,</span></span>
<span class="r-in"><span>    num_states <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>    num_boots <span class="op">=</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Inspect results</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">boot_samples</span><span class="op">)</span>  <span class="co"># 100 bootstrap replicates</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">boot_samples</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>  <span class="co"># Each is a 150 x 1 matrix</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Compare original and bootstrap distributions</span></span></span>
<span class="r-in"><span>  <span class="va">original_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x_univar</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">boot_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">boot_samples</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">boot_means</span>, main <span class="op">=</span> <span class="st">"Bootstrap Distribution of Mean"</span>,</span></span>
<span class="r-in"><span>       xlab <span class="op">=</span> <span class="st">"Mean"</span>, col <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">original_mean</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">## Example 2: Multivariate time series</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="co"># Two correlated series with regime switching</span></span></span>
<span class="r-in"><span>  <span class="va">states_true</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">states_true</span> <span class="op">==</span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>               <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x2</span> <span class="op">&lt;-</span> <span class="fl">0.7</span> <span class="op">*</span> <span class="va">x1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x_multivar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="va">boot_samples_mv</span> <span class="op">&lt;-</span> <span class="fu">hmm_bootstrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">x_multivar</span>,</span></span>
<span class="r-in"><span>    n_boot <span class="op">=</span> <span class="fl">180</span>,</span></span>
<span class="r-in"><span>    num_states <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>    num_boots <span class="op">=</span> <span class="fl">50</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">boot_samples_mv</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>  <span class="co"># 180 x 2 matrix</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Compute bootstrap correlation estimates</span></span></span>
<span class="r-in"><span>  <span class="va">boot_cors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">boot_samples_mv</span>, <span class="kw">function</span><span class="op">(</span><span class="va">b</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">b</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">original_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">x_multivar</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">x_multivar</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">boot_cors</span>, main <span class="op">=</span> <span class="st">"Bootstrap Distribution of Correlation"</span>,</span></span>
<span class="r-in"><span>       xlab <span class="op">=</span> <span class="st">"Correlation"</span>, col <span class="op">=</span> <span class="st">"lightgreen"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="va">original_cor</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">## Example 3: Variable-length bootstrap samples</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x_ar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/arima.sim.html" class="external-link">arima.sim</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">150</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ar <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Don't specify n_boot to get variable-length samples</span></span></span>
<span class="r-in"><span>  <span class="va">boot_samples_var</span> <span class="op">&lt;-</span> <span class="fu">hmm_bootstrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">x_ar</span>,</span></span>
<span class="r-in"><span>    n_boot <span class="op">=</span> <span class="cn">NULL</span>,  <span class="co"># Variable length</span></span></span>
<span class="r-in"><span>    num_states <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>    num_blocks <span class="op">=</span> <span class="fl">15</span>,</span></span>
<span class="r-in"><span>    num_boots <span class="op">=</span> <span class="fl">20</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Check lengths vary</span></span></span>
<span class="r-in"><span>  <span class="va">sample_lengths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">boot_samples_var</span>, <span class="va">nrow</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">sample_lengths</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">## Example 4: Using verbose mode for diagnostics</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">321</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x_diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="va">boot_samples_verbose</span> <span class="op">&lt;-</span> <span class="fu">hmm_bootstrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">x_diag</span>,</span></span>
<span class="r-in"><span>    n_boot <span class="op">=</span> <span class="fl">80</span>,</span></span>
<span class="r-in"><span>    num_states <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>    num_boots <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>    verbose <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co"># Print diagnostic information</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">## Example 5: Bootstrap confidence intervals</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">654</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co"># Data with heteroskedasticity</span></span></span>
<span class="r-in"><span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span></span>
<span class="r-in"><span>  <span class="va">x_hetero</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">i</span> <span class="op">&lt;=</span> <span class="va">n</span><span class="op">/</span><span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="va">x_hetero</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">2</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="va">boot_samples_ci</span> <span class="op">&lt;-</span> <span class="fu">hmm_bootstrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    x <span class="op">=</span> <span class="va">x_hetero</span>,</span></span>
<span class="r-in"><span>    n_boot <span class="op">=</span> <span class="fl">200</span>,</span></span>
<span class="r-in"><span>    num_states <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>    num_boots <span class="op">=</span> <span class="fl">500</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co"># Compute bootstrap confidence interval for the mean</span></span></span>
<span class="r-in"><span>  <span class="va">boot_means_ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">boot_samples_ci</span>, <span class="va">mean</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">ci_95</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">boot_means_ci</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"95% Bootstrap CI for mean:"</span>, <span class="va">ci_95</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"to"</span>, <span class="va">ci_95</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Original mean:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x_hetero</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="co">## Example 6: Basic usage</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">boot_samples</span> <span class="op">&lt;-</span> <span class="fu">hmm_bootstrap</span><span class="op">(</span><span class="va">x</span>, n_boot <span class="op">=</span> <span class="fl">400</span>, num_states <span class="op">=</span> <span class="fl">2</span>, num_boots <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## With diagnostics for regime visualization</span></span></span>
<span class="r-in"><span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">hmm_bootstrap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">x</span>, n_boot <span class="op">=</span> <span class="fl">400</span>, num_states <span class="op">=</span> <span class="fl">2</span>, num_boots <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span>    collect_diagnostics <span class="op">=</span> <span class="cn">TRUE</span>, return_fit <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## Plot regime composition</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="plot_regime_composition.html">plot_regime_composition</a></span><span class="op">(</span><span class="va">result</span>, <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged at iteration 14 with logLik: -345.2058 </span>
<span class="r-plt img"><img src="hmm_bootstrap-1.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged at iteration 21 with logLik: -641.5917 </span>
<span class="r-plt img"><img src="hmm_bootstrap-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged at iteration 22 with logLik: -237.4892 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Fitting 3-state Gaussian HMM to 1-dimensional series of length 100...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 0 logLik: -136.5052 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 5 logLik: -136.1879 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 10 logLik: -136.0729 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 15 logLik: -135.9875 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 20 logLik: -135.7953 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 25 logLik: -135.2338 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 30 logLik: -133.9723 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 35 logLik: -131.707 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 40 logLik: -128.8447 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 45 logLik: -127.3979 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 50 logLik: -126.9794 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 55 logLik: -126.8497 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 60 logLik: -126.806 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 65 logLik: -126.7847 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 70 logLik: -126.7683 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 75 logLik: -126.7525 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 80 logLik: -126.7373 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 85 logLik: -126.7237 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 90 logLik: -126.7126 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 95 logLik: -126.7041 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 100 logLik: -126.6979 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 105 logLik: -126.6934 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 110 logLik: -126.69 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 115 logLik: -126.6874 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 120 logLik: -126.6854 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 125 logLik: -126.6839 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 130 logLik: -126.6826 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 135 logLik: -126.6816 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 140 logLik: -126.6808 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 145 logLik: -126.6801 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 150 logLik: -126.6796 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 155 logLik: -126.6791 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 160 logLik: -126.6787 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 165 logLik: -126.6784 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 170 logLik: -126.6781 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 175 logLik: -126.6779 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 180 logLik: -126.6777 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 185 logLik: -126.6776 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 190 logLik: -126.6774 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 195 logLik: -126.6773 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 200 logLik: -126.6772 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 205 logLik: -126.6772 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 210 logLik: -126.6771 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 215 logLik: -126.677 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 220 logLik: -126.677 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 225 logLik: -126.6769 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 230 logLik: -126.6769 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 235 logLik: -126.6769 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 240 logLik: -126.6769 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 245 logLik: -126.6768 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 250 logLik: -126.6768 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 255 logLik: -126.6768 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 260 logLik: -126.6768 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 265 logLik: -126.6768 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 270 logLik: -126.6768 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> iteration 275 logLik: -126.6768 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged at iteration 280 with logLik: -126.6768 </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> State distribution: 1 = 19, 2 = 47, 3 = 34</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Generating 5 bootstrap samples...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Bootstrap complete. Generated 5 samples.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged at iteration 22 with logLik: -393.5627 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 95% Bootstrap CI for mean: 1.60645 to 1.878304 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Original mean: 1.747322 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged at iteration 184 with logLik: -687.2476 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> converged at iteration 175 with logLik: -687.2476 </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Argument 'type' not specified and will default to 'viterbi'. This default may change in future releases of depmixS4. Please see ?posterior for alternative options.</span>
<span class="r-plt img"><img src="hmm_bootstrap-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span>  </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Hoshi Vognsen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

