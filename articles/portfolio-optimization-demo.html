<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Portfolio Optimization with Multivariate GARCH Model Comparison • tsbs</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Portfolio Optimization with Multivariate GARCH Model Comparison">
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">tsbs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/bootstrap_diagnostics.html">Bootstrap Diagnostics Guide</a></li>
    <li><a class="dropdown-item" href="../articles/cgarch_vs_dcc.html">Copula GARCH vs DCC: Model Comparison and Diagnostics</a></li>
    <li><a class="dropdown-item" href="../articles/dcc_inference_guide.html">DCC Parameter Inference Guide</a></li>
    <li><a class="dropdown-item" href="../articles/ms-varma-garch_diagnostics.html">Diagnostic System for MS-VARMA-GARCH Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/ms-varma-garch_inference.html">MS-VARMA-GARCH Parameter Inference Guide</a></li>
    <li><a class="dropdown-item" href="../articles/multivariate_garch_comparison.html">Multivariate GARCH Model Comparison: DCC, CGARCH, and GOGARCH</a></li>
    <li><a class="dropdown-item" href="../articles/portfolio-optimization-demo.html">Portfolio Optimization with Multivariate GARCH Model Comparison</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Portfolio Optimization with Multivariate GARCH Model Comparison</h1>
                        <h4 data-toc-skip class="author">Martin Hoshi
Vognsen</h4>
            
            <h4 data-toc-skip class="date">13:32 28 January 2026</h4>
      

      <div class="d-none name"><code>portfolio-optimization-demo.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mahovo.github.io/tsbs/">tsbs</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.quantmod.com/" class="external-link">quantmod</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gridExtra</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## =============================================================================</span></span>
<span><span class="co">## GLOBAL SETTINGS - Adjust these to control computation time and data source</span></span>
<span><span class="co">## =============================================================================</span></span>
<span></span>
<span><span class="co">## Set to TRUE for full analysis, FALSE for quick demo</span></span>
<span><span class="va">FULL_ANALYSIS</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span></span>
<span><span class="co">## Data source: "package" uses pre-downloaded data from tsbs package</span></span>
<span><span class="co">##              "download" fetches fresh data from Yahoo Finance</span></span>
<span><span class="va">DATA_SOURCE</span> <span class="op">&lt;-</span> <span class="st">"package"</span>  <span class="co">## Options: "package" or "download"</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">FULL_ANALYSIS</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">max_num_rb</span> <span class="op">&lt;-</span> <span class="fl">10</span>      <span class="co">## Number of rebalances with bootstrap</span></span>
<span>  <span class="va">max_iter</span> <span class="op">&lt;-</span> <span class="fl">20</span>        <span class="co">## Maximum EM iterations per model</span></span>
<span>  <span class="va">num_boots</span> <span class="op">&lt;-</span> <span class="fl">100</span>         <span class="co">## Bootstrap replicates per rebalance</span></span>
<span>  <span class="va">train_window</span> <span class="op">&lt;-</span> <span class="fl">504</span>   <span class="co">## ~2 years training</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">max_num_rb</span> <span class="op">&lt;-</span> <span class="fl">3</span>       <span class="co">## Quick demo: 3 rebalances</span></span>
<span>  <span class="va">max_iter</span> <span class="op">&lt;-</span> <span class="fl">3</span>         <span class="co">## Quick demo: 3 iterations</span></span>
<span>  <span class="va">num_boots</span> <span class="op">&lt;-</span> <span class="fl">30</span>          <span class="co">## Quick demo: 30 replicates</span></span>
<span>  <span class="va">train_window</span> <span class="op">&lt;-</span> <span class="fl">252</span>   <span class="co">## Quick demo: 1 year training</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">collect_diagnostics</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">verbose</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span>
<span><span class="va">return_fit</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette demonstrates advanced portfolio optimization using the
<strong>tsbs</strong> package’s Markov-Switching VARMA-GARCH bootstrap
framework. We compare three multivariate GARCH correlation
structures:</p>
<ol style="list-style-type: decimal">
<li>
<strong>DCC (Dynamic Conditional Correlation)</strong>: The
workhorse model with explicit correlation dynamics</li>
<li>
<strong>CGARCH (Copula GARCH)</strong>: Separates marginals from
dependence via copula theory</li>
<li>
<strong>GOGARCH (Generalized Orthogonal GARCH)</strong>: Uses ICA to
extract independent factors</li>
</ol>
<p>Each model captures time-varying correlations differently, leading to
potentially different portfolio allocations and uncertainty
quantification.</p>
<div class="section level3">
<h3 id="key-features-demonstrated">Key Features Demonstrated<a class="anchor" aria-label="anchor" href="#key-features-demonstrated"></a>
</h3>
<ul>
<li>Six portfolio optimization strategies with real market data</li>
<li>Out-of-sample backtesting with quarterly rebalancing</li>
<li>
<strong>Bootstrap uncertainty quantification</strong> comparing all
three GARCH models</li>
<li>
<strong>Bootstrap diagnostics</strong> using the
<code>tsbs_diagnostics</code> system</li>
<li>Comprehensive performance analysis with transaction costs</li>
</ul>
</div>
<div class="section level3">
<h3 id="what-is-a-bootstrapped-series">What is a Bootstrapped Series?<a class="anchor" aria-label="anchor" href="#what-is-a-bootstrapped-series"></a>
</h3>
<p>Before diving into portfolio optimization, let’s visualize what the
MS-VARMA-GARCH bootstrap actually produces. The basic idea is:</p>
<ol style="list-style-type: decimal">
<li>Take raw price data and compute log-returns</li>
<li>Fit a Markov-Switching model that identifies different market
regimes (e.g., calm vs. volatile periods)</li>
<li>Generate new return series by resampling blocks of returns while
respecting the regime structure</li>
<li>Convert the bootstrapped returns back to a synthetic price
series</li>
</ol>
<p>The plot below shows an original SPY price series alongside a
bootstrapped version. The colored bands indicate the estimated market
regimes—notice how the bootstrap preserves the general character of each
regime while creating a genuinely new path.</p>
<p><img src="portfolio-optimization-demo_files/figure-html/bootstrap_illustration-1.png" class="r-plt" alt="" width="960"></p>
<p>The bootstrap series (bottom panel) is not a forecast—it’s a
<em>plausible alternative history</em> that could have occurred given
the same underlying market dynamics. By generating many such series and
computing portfolio weights on each, we can quantify how uncertain our
optimal allocation really is.</p>
</div>
</div>
<div class="section level2">
<h2 id="part-1-portfolio-optimization-functions">Part 1: Portfolio Optimization Functions<a class="anchor" aria-label="anchor" href="#part-1-portfolio-optimization-functions"></a>
</h2>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## =============================================================================</span></span>
<span><span class="co">## PORTFOLIO OPTIMIZATION FUNCTIONS</span></span>
<span><span class="co">## =============================================================================</span></span>
<span></span>
<span><span class="co">## 1.1 Minimum Variance Portfolio</span></span>
<span><span class="va">min_variance_portfolio</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">returns</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"quadprog"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Dmat</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">Sigma</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1e-8</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">dvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">Amat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">bvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sol</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>      <span class="fu">quadprog</span><span class="fu">::</span><span class="fu">solve.QP</span><span class="op">(</span><span class="va">Dmat</span>, <span class="va">dvec</span>, <span class="va">Amat</span>, <span class="va">bvec</span>, meq <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">solution</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">ones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">Sigma_inv</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">Sigma</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1e-6</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                          error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">Sigma_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">ones</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">ones</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Sigma_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">ones</span><span class="op">)</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">weights</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">weights</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 1.2 Maximum Sharpe Ratio Portfolio</span></span>
<span><span class="va">max_sharpe_portfolio</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">returns</span>, <span class="va">rf</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">mu_excess</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">-</span> <span class="va">rf</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">mu_excess</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">min_variance_portfolio</span><span class="op">(</span><span class="va">returns</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"quadprog"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Dmat</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">Sigma</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1e-8</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">dvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">Amat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">mu_excess</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">bvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sol</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>      <span class="fu">quadprog</span><span class="fu">::</span><span class="fu">solve.QP</span><span class="op">(</span><span class="va">Dmat</span>, <span class="va">dvec</span>, <span class="va">Amat</span>, <span class="va">bvec</span>, meq <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">solution</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">solution</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu">min_variance_portfolio</span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu">min_variance_portfolio</span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">weights</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 1.3 Risk Parity Portfolio</span></span>
<span><span class="va">risk_parity_portfolio</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">returns</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">vols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">vols</span><span class="op">)</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">vols</span> <span class="op">&lt;</span> <span class="fl">1e-10</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="va">vols</span></span>
<span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">iter</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">port_vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Sigma</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">weights</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">port_vol</span><span class="op">)</span> <span class="op">||</span> <span class="va">port_vol</span> <span class="op">&lt;</span> <span class="fl">1e-10</span><span class="op">)</span> <span class="kw">break</span></span>
<span>    </span>
<span>    <span class="va">mrc</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">Sigma</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">weights</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">port_vol</span><span class="op">)</span></span>
<span>    <span class="va">rc</span> <span class="op">&lt;-</span> <span class="va">weights</span> <span class="op">*</span> <span class="va">mrc</span></span>
<span>    <span class="va">target_rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">rc</span><span class="op">)</span> <span class="op">/</span> <span class="va">n</span></span>
<span>    <span class="va">adjustment</span> <span class="op">&lt;-</span> <span class="va">target_rc</span> <span class="op">/</span> <span class="op">(</span><span class="va">rc</span> <span class="op">+</span> <span class="fl">1e-8</span><span class="op">)</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">adjustment</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">1e-10</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>      <span class="kw">break</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">weights</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 1.4 Black-Litterman Portfolio</span></span>
<span><span class="va">black_litterman_portfolio</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">returns</span>, <span class="va">risk_aversion</span> <span class="op">=</span> <span class="fl">2.5</span>, <span class="va">tau</span> <span class="op">=</span> <span class="fl">0.05</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mu_hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">w_mkt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">pi</span> <span class="op">&lt;-</span> <span class="va">risk_aversion</span> <span class="op">*</span> <span class="va">Sigma</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">w_mkt</span></span>
<span>  </span>
<span>  <span class="va">P</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">Q</span> <span class="op">&lt;-</span> <span class="va">mu_hist</span></span>
<span>  <span class="va">omega_diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">Sigma</span><span class="op">)</span> <span class="op">*</span> <span class="va">tau</span></span>
<span>  <span class="va">Omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">omega_diag</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">tau_Sigma</span> <span class="op">&lt;-</span> <span class="va">tau</span> <span class="op">*</span> <span class="va">Sigma</span></span>
<span>  <span class="va">tau_Sigma_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">tau_Sigma</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1e-8</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Omega_inv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">Omega</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1e-8</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">M_inv</span> <span class="op">&lt;-</span> <span class="va">tau_Sigma_inv</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Omega_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">P</span></span>
<span>  <span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">M_inv</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1e-8</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">mu_bl</span> <span class="op">&lt;-</span> <span class="va">M</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">tau_Sigma_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">pi</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">P</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Omega_inv</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Q</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"quadprog"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Sigma_bl</span> <span class="op">&lt;-</span> <span class="va">Sigma</span> <span class="op">+</span> <span class="va">tau_Sigma</span></span>
<span>    <span class="va">Dmat</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">risk_aversion</span> <span class="op">*</span> <span class="va">Sigma_bl</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1e-8</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">dvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">mu_bl</span><span class="op">)</span></span>
<span>    <span class="va">Amat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">bvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sol</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>      <span class="fu">quadprog</span><span class="fu">::</span><span class="fu">solve.QP</span><span class="op">(</span><span class="va">Dmat</span>, <span class="va">dvec</span>, <span class="va">Amat</span>, <span class="va">bvec</span>, meq <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">solution</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">weights</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 1.5 Mean-Variance with Shrinkage (Ledoit-Wolf)</span></span>
<span><span class="va">shrinkage_portfolio</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">returns</span>, <span class="va">target_return</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mu</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">T_obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">trace_S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">S</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">F_target</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">trace_S</span> <span class="op">/</span> <span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">returns</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">sum_sq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">S</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span>  <span class="va">delta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">T_obs</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">sum_sq</span> <span class="op">/</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1e-8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">Sigma_shrunk</span> <span class="op">&lt;-</span> <span class="va">delta</span> <span class="op">*</span> <span class="va">F_target</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">delta</span><span class="op">)</span> <span class="op">*</span> <span class="va">S</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"quadprog"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">Dmat</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">Sigma_shrunk</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1e-8</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">dvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">Amat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">bvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">sol</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>      <span class="fu">quadprog</span><span class="fu">::</span><span class="fu">solve.QP</span><span class="op">(</span><span class="va">Dmat</span>, <span class="va">dvec</span>, <span class="va">Amat</span>, <span class="va">bvec</span>, meq <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>      error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">sol</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">sol</span><span class="op">$</span><span class="va">solution</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">weights</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">weights</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## 1.6 Equal Weight (Benchmark)</span></span>
<span><span class="va">equal_weight_portfolio</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">returns</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">n</span>, <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weights</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">returns</span><span class="op">)</span></span>
<span>  <span class="va">weights</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Portfolio performance metrics</span></span>
<span><span class="va">calc_portfolio_metrics</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">returns</span>, <span class="va">weights</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">port_ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">returns</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">weights</span><span class="op">)</span></span>
<span>  <span class="va">ann_factor</span> <span class="op">&lt;-</span> <span class="fl">252</span></span>
<span>  </span>
<span>  <span class="va">mean_ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">port_ret</span><span class="op">)</span> <span class="op">*</span> <span class="va">ann_factor</span></span>
<span>  <span class="va">vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">port_ret</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ann_factor</span><span class="op">)</span></span>
<span>  <span class="va">sharpe</span> <span class="op">&lt;-</span> <span class="va">mean_ret</span> <span class="op">/</span> <span class="va">vol</span></span>
<span>  </span>
<span>  <span class="va">cum_ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumprod</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">port_ret</span><span class="op">)</span></span>
<span>  <span class="va">rolling_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cummax</a></span><span class="op">(</span><span class="va">cum_ret</span><span class="op">)</span></span>
<span>  <span class="va">drawdown</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">cum_ret</span> <span class="op">-</span> <span class="va">rolling_max</span><span class="op">)</span> <span class="op">/</span> <span class="va">rolling_max</span></span>
<span>  <span class="va">max_dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">drawdown</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">downside_ret</span> <span class="op">&lt;-</span> <span class="va">port_ret</span><span class="op">[</span><span class="va">port_ret</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span></span>
<span>  <span class="va">downside_dev</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">downside_ret</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">downside_ret</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">ann_factor</span><span class="op">)</span> <span class="kw">else</span> <span class="va">vol</span></span>
<span>  <span class="va">sortino</span> <span class="op">&lt;-</span> <span class="va">mean_ret</span> <span class="op">/</span> <span class="va">downside_dev</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Ann.Return"</span> <span class="op">=</span> <span class="va">mean_ret</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    <span class="st">"Ann.Vol"</span> <span class="op">=</span> <span class="va">vol</span> <span class="op">*</span> <span class="fl">100</span>,</span>
<span>    <span class="st">"Sharpe"</span> <span class="op">=</span> <span class="va">sharpe</span>,</span>
<span>    <span class="st">"Sortino"</span> <span class="op">=</span> <span class="va">sortino</span>,</span>
<span>    <span class="st">"MaxDD"</span> <span class="op">=</span> <span class="va">max_dd</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="part-2-data-download-and-preparation">Part 2: Data Download and Preparation<a class="anchor" aria-label="anchor" href="#part-2-data-download-and-preparation"></a>
</h2>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<pre><code><span><span class="co">## ADVANCED PORTFOLIO OPTIMIZATION WITH MULTIVARIATE GARCH COMPARISON</span></span></code></pre>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Asset information</span></span>
<span><span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SPY"</span>, <span class="st">"EFA"</span>, <span class="st">"BND"</span>, <span class="st">"GLD"</span>, <span class="st">"VNQ"</span><span class="op">)</span></span>
<span><span class="va">symbol_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"US Equity"</span>, <span class="st">"Intl Equity"</span>, <span class="st">"US Bonds"</span>, <span class="st">"Gold"</span>, <span class="st">"REITs"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DATA_SOURCE</span> <span class="op">==</span> <span class="st">"package"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## -------------------------------------------------------------------------</span></span>
<span>  <span class="co">## Option 1: Use pre-downloaded data from tsbs package</span></span>
<span>  <span class="co">## -------------------------------------------------------------------------</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"etf_returns"</span>, package <span class="op">=</span> <span class="st">"tsbs"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">y_full</span> <span class="op">&lt;-</span> <span class="va">etf_returns</span></span>
<span>  <span class="va">dates_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">etf_returns</span>, <span class="st">"dates"</span><span class="op">)</span></span>
<span>  <span class="va">symbols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">etf_returns</span>, <span class="st">"symbols"</span><span class="op">)</span></span>
<span>  <span class="va">symbol_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">etf_returns</span>, <span class="st">"symbol_names"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nUsing package data (etf_returns)\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Source:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">etf_returns</span>, <span class="st">"source"</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Downloaded:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">etf_returns</span>, <span class="st">"download_date"</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="co">## -------------------------------------------------------------------------</span></span>
<span>  <span class="co">## Option 2: Download fresh data from Yahoo Finance</span></span>
<span>  <span class="co">## -------------------------------------------------------------------------</span></span>
<span>  <span class="va">start_date</span> <span class="op">&lt;-</span> <span class="st">"2018-01-01"</span></span>
<span>  <span class="va">end_date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nDownloading fresh data from Yahoo Finance...\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Symbols:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">symbols</span>, collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Date range:"</span>, <span class="va">start_date</span>, <span class="st">"to"</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">end_date</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">prices_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">symbols</span>, <span class="kw">function</span><span class="op">(</span><span class="va">sym</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/pkg/quantmod/man/getSymbols.html" class="external-link">getSymbols</a></span><span class="op">(</span><span class="va">sym</span>, src <span class="op">=</span> <span class="st">"yahoo"</span>, from <span class="op">=</span> <span class="va">start_date</span>, to <span class="op">=</span> <span class="va">end_date</span>, </span>
<span>                 auto.assign <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Failed to download"</span>, <span class="va">sym</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="cn">NULL</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">valid_idx</span> <span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">prices_list</span>, <span class="va">is.null</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">valid_idx</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Could not download enough symbols. Check internet connection."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">symbols</span> <span class="op">&lt;-</span> <span class="va">symbols</span><span class="op">[</span><span class="va">valid_idx</span><span class="op">]</span></span>
<span>  <span class="va">symbol_names</span> <span class="op">&lt;-</span> <span class="va">symbol_names</span><span class="op">[</span><span class="va">valid_idx</span><span class="op">]</span></span>
<span>  <span class="va">prices_list</span> <span class="op">&lt;-</span> <span class="va">prices_list</span><span class="op">[</span><span class="va">valid_idx</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">adj_close</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">merge</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">prices_list</span>, <span class="va">Ad</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">adj_close</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">symbols</span></span>
<span>  <span class="va">adj_close</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">adj_close</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">returns_xts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">adj_close</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="va">returns_xts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/na.fail.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="va">returns_xts</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">y_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/coredata.html" class="external-link">coredata</a></span><span class="op">(</span><span class="va">returns_xts</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">dates_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/index.html" class="external-link">index</a></span><span class="op">(</span><span class="va">returns_xts</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Using package data (etf_returns)</span></span>
<span><span class="co">##   Source: Yahoo Finance via quantmod </span></span>
<span><span class="co">##   Downloaded: 2026-01-21</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">y_full</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Data summary:</span></span></code></pre>
<pre><code><span><span class="co">##   Period: 2018-01-03 to 2024-12-30</span></span></code></pre>
<pre><code><span><span class="co">##   Observations: 1759</span></span></code></pre>
<pre><code><span><span class="co">##   Assets: SPY, EFA, BND, GLD, VNQ</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## IN-SAMPLE STATISTICS</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Annualized statistics:</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ann_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="st">"Return (%)"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">y_full</span><span class="op">)</span> <span class="op">*</span> <span class="fl">252</span>,</span>
<span>  <span class="st">"Vol (%)"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">y_full</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">252</span><span class="op">)</span>,</span>
<span>  <span class="st">"Sharpe"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">y_full</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">y_full</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">252</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ann_stats</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              SPY   EFA  BND   GLD   VNQ</span></span>
<span><span class="co">## Return (%) 12.84  3.90 1.06  9.37  4.79</span></span>
<span><span class="co">## Vol (%)    19.54 18.27 6.16 14.33 23.12</span></span>
<span><span class="co">## Sharpe      0.66  0.21 0.17  0.65  0.21</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Correlation matrix:</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">y_full</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      SPY  EFA  BND  GLD  VNQ</span></span>
<span><span class="co">## SPY 1.00 0.87 0.16 0.11 0.76</span></span>
<span><span class="co">## EFA 0.87 1.00 0.20 0.21 0.71</span></span>
<span><span class="co">## BND 0.16 0.20 1.00 0.36 0.29</span></span>
<span><span class="co">## GLD 0.11 0.21 0.36 1.00 0.16</span></span>
<span><span class="co">## VNQ 0.76 0.71 0.29 0.16 1.00</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="part-3-model-specifications">Part 3: Model Specifications<a class="anchor" aria-label="anchor" href="#part-3-model-specifications"></a>
</h2>
<p>We define specifications for three multivariate GARCH model
types:</p>
<ul>
<li>
<strong>DCC</strong>: Uses <code>dcc_modelspec</code> with
correlation dynamics (α, β)</li>
<li>
<strong>CGARCH</strong>: Uses <code>cgarch_modelspec</code> with
copula-based dependence</li>
<li>
<strong>GOGARCH</strong>: Uses <code>gogarch_modelspec</code> with
ICA decomposition</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## =============================================================================</span></span>
<span><span class="co">## MODEL SPECIFICATIONS FOR DCC, CGARCH, AND GOGARCH</span></span>
<span><span class="co">## =============================================================================</span></span>
<span></span>
<span><span class="co">## --- DCC Specification ---</span></span>
<span><span class="va">make_dcc_spec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">omega</span>, <span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">dcc_alpha</span>, <span class="va">dcc_beta</span>, <span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    var_order <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    garch_spec_fun <span class="op">=</span> <span class="st">"dcc_modelspec"</span>,</span>
<span>    distribution <span class="op">=</span> <span class="st">"mvn"</span>,</span>
<span>    garch_spec_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      dcc_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      dynamics <span class="op">=</span> <span class="st">"dcc"</span>,</span>
<span>      garch_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        univariate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"garch"</span>, garch_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, distribution <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    start_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      var_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">k</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      garch_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>omega <span class="op">=</span> <span class="va">omega</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, alpha1 <span class="op">=</span> <span class="va">alpha</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, beta1 <span class="op">=</span> <span class="va">beta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span>,</span>
<span>      dcc_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha_1 <span class="op">=</span> <span class="va">dcc_alpha</span>, beta_1 <span class="op">=</span> <span class="va">dcc_beta</span><span class="op">)</span>,</span>
<span>      dist_pars <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">spec_dcc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">make_dcc_spec</span><span class="op">(</span></span>
<span>    omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="va">k</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="va">k</span><span class="op">)</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.90</span>, <span class="va">k</span><span class="op">)</span>,</span>
<span>    dcc_alpha <span class="op">=</span> <span class="fl">0.02</span>, dcc_beta <span class="op">=</span> <span class="fl">0.95</span>, k <span class="op">=</span> <span class="va">k</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">make_dcc_spec</span><span class="op">(</span></span>
<span>    omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="va">k</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.12</span>, <span class="va">k</span><span class="op">)</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.80</span>, <span class="va">k</span><span class="op">)</span>,</span>
<span>    dcc_alpha <span class="op">=</span> <span class="fl">0.06</span>, dcc_beta <span class="op">=</span> <span class="fl">0.90</span>, k <span class="op">=</span> <span class="va">k</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## --- CGARCH Specification ---</span></span>
<span><span class="va">make_cgarch_spec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">omega</span>, <span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">dcc_alpha</span>, <span class="va">dcc_beta</span>, <span class="va">k</span>, </span>
<span>                              <span class="va">copula</span> <span class="op">=</span> <span class="st">"mvn"</span>, <span class="va">transformation</span> <span class="op">=</span> <span class="st">"parametric"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    var_order <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    garch_spec_fun <span class="op">=</span> <span class="st">"cgarch_modelspec"</span>,</span>
<span>    distribution <span class="op">=</span> <span class="va">copula</span>,</span>
<span>    garch_spec_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      dcc_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      dynamics <span class="op">=</span> <span class="st">"dcc"</span>,</span>
<span>      transformation <span class="op">=</span> <span class="va">transformation</span>,</span>
<span>      copula <span class="op">=</span> <span class="va">copula</span>,</span>
<span>      garch_model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        univariate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"garch"</span>, garch_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, distribution <span class="op">=</span> <span class="st">"norm"</span><span class="op">)</span></span>
<span>        <span class="op">}</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    start_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      var_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">k</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      garch_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>omega <span class="op">=</span> <span class="va">omega</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, alpha1 <span class="op">=</span> <span class="va">alpha</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, beta1 <span class="op">=</span> <span class="va">beta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span>,</span>
<span>      dcc_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha_1 <span class="op">=</span> <span class="va">dcc_alpha</span>, beta_1 <span class="op">=</span> <span class="va">dcc_beta</span><span class="op">)</span>,</span>
<span>      dist_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>  <span class="co">## For MVT copula</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># spec_cgarch &lt;- list(</span></span>
<span><span class="co">#   make_cgarch_spec(</span></span>
<span><span class="co">#     omega = rep(0.02, k), alpha = rep(0.05, k), beta = rep(0.90, k),</span></span>
<span><span class="co">#     dcc_alpha = 0.02, dcc_beta = 0.95, k = k, </span></span>
<span><span class="co">#     copula = "mvn", transformation = "parametric"</span></span>
<span><span class="co">#   ),</span></span>
<span><span class="co">#   make_cgarch_spec(</span></span>
<span><span class="co">#     omega = rep(0.08, k), alpha = rep(0.12, k), beta = rep(0.80, k),</span></span>
<span><span class="co">#     dcc_alpha = 0.06, dcc_beta = 0.90, k = k,</span></span>
<span><span class="co">#     copula = "mvn", transformation = "parametric"</span></span>
<span><span class="co">#   )</span></span>
<span><span class="co"># )</span></span>
<span></span>
<span><span class="va">spec_cgarch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">make_cgarch_spec</span><span class="op">(</span></span>
<span>    omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="va">k</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="va">k</span><span class="op">)</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.90</span>, <span class="va">k</span><span class="op">)</span>,</span>
<span>    dcc_alpha <span class="op">=</span> <span class="fl">0.02</span>, dcc_beta <span class="op">=</span> <span class="fl">0.95</span>, k <span class="op">=</span> <span class="va">k</span>, </span>
<span>    copula <span class="op">=</span> <span class="st">"mvt"</span>, transformation <span class="op">=</span> <span class="st">"parametric"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">make_cgarch_spec</span><span class="op">(</span></span>
<span>    omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="va">k</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.12</span>, <span class="va">k</span><span class="op">)</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.80</span>, <span class="va">k</span><span class="op">)</span>,</span>
<span>    dcc_alpha <span class="op">=</span> <span class="fl">0.06</span>, dcc_beta <span class="op">=</span> <span class="fl">0.90</span>, k <span class="op">=</span> <span class="va">k</span>,</span>
<span>    copula <span class="op">=</span> <span class="st">"mvt"</span>, transformation <span class="op">=</span> <span class="st">"parametric"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## --- GOGARCH Specification ---</span></span>
<span><span class="va">make_gogarch_spec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">omega</span>, <span class="va">alpha</span>, <span class="va">beta</span>, <span class="va">k</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    var_order <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    garch_spec_fun <span class="op">=</span> <span class="st">"gogarch_modelspec"</span>,</span>
<span>    distribution <span class="op">=</span> <span class="st">"norm"</span>,</span>
<span>    garch_spec_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      model <span class="op">=</span> <span class="st">"garch"</span>,</span>
<span>      order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>      ica <span class="op">=</span> <span class="st">"radical"</span>,</span>
<span>      components <span class="op">=</span> <span class="va">k</span></span>
<span>    <span class="op">)</span>,</span>
<span>    start_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      var_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">k</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">k</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      garch_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">k</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>omega <span class="op">=</span> <span class="va">omega</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, alpha1 <span class="op">=</span> <span class="va">alpha</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, beta1 <span class="op">=</span> <span class="va">beta</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span><span class="op">)</span>,</span>
<span>      dist_pars <span class="op">=</span> <span class="cn">NULL</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">spec_gogarch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu">make_gogarch_spec</span><span class="op">(</span></span>
<span>    omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="va">k</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="va">k</span><span class="op">)</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.90</span>, <span class="va">k</span><span class="op">)</span>, k <span class="op">=</span> <span class="va">k</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">make_gogarch_spec</span><span class="op">(</span></span>
<span>    omega <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.08</span>, <span class="va">k</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.12</span>, <span class="va">k</span><span class="op">)</span>, beta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.80</span>, <span class="va">k</span><span class="op">)</span>, k <span class="op">=</span> <span class="va">k</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Model specifications created:</span></span></code></pre>
<pre><code><span><span class="co">##   - DCC: 2 regime states with DCC(1,1) dynamics</span></span></code></pre>
<pre><code><span><span class="co">##   - CGARCH: 2 regime states with MVN copula</span></span></code></pre>
<pre><code><span><span class="co">##   - GOGARCH: 2 regime states with RADICAL ICA</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="part-4-backtest-setup">Part 4: Backtest Setup<a class="anchor" aria-label="anchor" href="#part-4-backtest-setup"></a>
</h2>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<pre><code><span><span class="co">## OUT-OF-SAMPLE BACKTEST</span></span></code></pre>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Parameters</span></span>
<span><span class="va">rebalance_freq</span> <span class="op">&lt;-</span> <span class="fl">63</span>  <span class="co">## Quarterly rebalancing</span></span>
<span></span>
<span><span class="va">n_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">y_full</span><span class="op">)</span></span>
<span><span class="va">rebalance_dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">train_window</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">n_total</span> <span class="op">-</span> <span class="va">rebalance_freq</span>, by <span class="op">=</span> <span class="va">rebalance_freq</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Backtest setup:</span></span></code></pre>
<pre><code><span><span class="co">##   Training window: 252 days</span></span></code></pre>
<pre><code><span><span class="co">##   Rebalance frequency: 63 days (~quarterly)</span></span></code></pre>
<pre><code><span><span class="co">##   Number of rebalances: 23</span></span></code></pre>
<pre><code><span><span class="co">##   Bootstrap replicates per rebalance: 30</span></span></code></pre>
<pre><code><span><span class="co">##   Max rebalances with bootstrap: 3</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Strategies to test</span></span>
<span><span class="va">strategies</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Equal Weight"</span> <span class="op">=</span> <span class="va">equal_weight_portfolio</span>,</span>
<span>  <span class="st">"Min Variance"</span> <span class="op">=</span> <span class="va">min_variance_portfolio</span>,</span>
<span>  <span class="st">"Max Sharpe"</span> <span class="op">=</span> <span class="va">max_sharpe_portfolio</span>,</span>
<span>  <span class="st">"Risk Parity"</span> <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>  <span class="st">"Black-Litterman"</span> <span class="op">=</span> <span class="va">black_litterman_portfolio</span>,</span>
<span>  <span class="st">"Shrinkage"</span> <span class="op">=</span> <span class="va">shrinkage_portfolio</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Storage for results</span></span>
<span><span class="va">backtest_returns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="va">n_total</span> <span class="op">-</span> <span class="va">train_window</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">strategies</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">backtest_returns</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">strategies</span><span class="op">)</span></span>
<span></span>
<span><span class="va">weight_history</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">strategies</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="cn">NA</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rebalance_dates</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="va">k</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="part-5-multi-model-bootstrap-backtest">Part 5: Multi-Model Bootstrap Backtest<a class="anchor" aria-label="anchor" href="#part-5-multi-model-bootstrap-backtest"></a>
</h2>
<p>This is the core of our analysis. For each rebalance period, we run
bootstrap using all three GARCH model types and compare their
uncertainty estimates.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## =============================================================================</span></span>
<span><span class="co">## RUN BACKTEST WITH DCC, CGARCH, AND GOGARCH COMPARISON</span></span>
<span><span class="co">## =============================================================================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nRunning backtest with multi-model bootstrap comparison...\n"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="va">current_weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">strategies</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="va">k</span>, <span class="va">k</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html" class="external-link">txtProgressBar</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rebalance_dates</span><span class="op">)</span>, style <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Storage for bootstrap results from each model type</span></span>
<span><span class="va">boot_results_dcc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">boot_results_cgarch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">boot_results_gogarch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Storage for diagnostics from each model</span></span>
<span><span class="va">diagnostics_dcc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">diagnostics_cgarch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">diagnostics_gogarch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">rb_idx</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">rebalance_dates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rb_date</span> <span class="op">&lt;-</span> <span class="va">rebalance_dates</span><span class="op">[</span><span class="va">rb_idx</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">## Training data</span></span>
<span>  <span class="va">train_start</span> <span class="op">&lt;-</span> <span class="va">rb_date</span> <span class="op">-</span> <span class="va">train_window</span></span>
<span>  <span class="va">train_end</span> <span class="op">&lt;-</span> <span class="va">rb_date</span> <span class="op">-</span> <span class="fl">1</span></span>
<span>  <span class="va">y_train</span> <span class="op">&lt;-</span> <span class="va">y_full</span><span class="op">[</span><span class="va">train_start</span><span class="op">:</span><span class="va">train_end</span>, <span class="op">]</span></span>
<span>  </span>
<span>  <span class="co">## Compute new weights for each strategy</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">strat_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">strategies</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">strat_func</span> <span class="op">&lt;-</span> <span class="va">strategies</span><span class="op">[[</span><span class="va">strat_name</span><span class="op">]</span><span class="op">]</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">new_weights</span> <span class="op">&lt;-</span> <span class="fu">strat_func</span><span class="op">(</span><span class="va">y_train</span><span class="op">)</span></span>
<span>      <span class="va">current_weights</span><span class="op">[[</span><span class="va">strat_name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">new_weights</span></span>
<span>      <span class="va">weight_history</span><span class="op">[[</span><span class="va">strat_name</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">rb_idx</span>, <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">new_weights</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co">## Keep previous weights on error</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">## Run multi-model bootstrap for first max_num_rb rebalances</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">rb_idx</span> <span class="op">&lt;=</span> <span class="va">max_num_rb</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="co">## --- DCC Bootstrap ---</span></span>
<span>    <span class="va">result_dcc</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">boot_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">y_train</span>,</span>
<span>        bs_type <span class="op">=</span> <span class="st">"ms_varma_garch"</span>,</span>
<span>        num_boots <span class="op">=</span> <span class="va">num_boots</span>,</span>
<span>        num_blocks <span class="op">=</span> <span class="fl">15</span>,</span>
<span>        num_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        spec <span class="op">=</span> <span class="va">spec_dcc</span>,</span>
<span>        model_type <span class="op">=</span> <span class="st">"multivariate"</span>,</span>
<span>        func <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>        apply_func_to <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_iter <span class="op">=</span> <span class="va">max_iter</span>, tol <span class="op">=</span> <span class="fl">1e-2</span><span class="op">)</span>,</span>
<span>        parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        num_cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>        return_fit <span class="op">=</span> <span class="va">return_fit</span>,</span>
<span>        collect_diagnostics <span class="op">=</span> <span class="va">collect_diagnostics</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">boot_result</span><span class="op">$</span><span class="va">func_outs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        diagnostics <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">collect_diagnostics</span> <span class="op">&amp;&amp;</span> <span class="va">return_fit</span><span class="op">)</span> <span class="va">boot_result</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">diagnostics</span> <span class="kw">else</span> <span class="cn">NULL</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"DCC bootstrap failed at rebalance "</span>, <span class="va">rb_idx</span>, <span class="st">": "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>      <span class="cn">NULL</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">result_dcc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">boot_results_dcc</span><span class="op">[[</span><span class="va">rb_idx</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result_dcc</span><span class="op">$</span><span class="va">weights</span></span>
<span>      <span class="va">diagnostics_dcc</span><span class="op">[[</span><span class="va">rb_idx</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result_dcc</span><span class="op">$</span><span class="va">diagnostics</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## --- CGARCH Bootstrap ---</span></span>
<span>    <span class="va">result_cgarch</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">boot_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">y_train</span>,</span>
<span>        bs_type <span class="op">=</span> <span class="st">"ms_varma_garch"</span>,</span>
<span>        num_boots <span class="op">=</span> <span class="va">num_boots</span>,</span>
<span>        num_blocks <span class="op">=</span> <span class="fl">15</span>,</span>
<span>        num_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        spec <span class="op">=</span> <span class="va">spec_cgarch</span>,</span>
<span>        model_type <span class="op">=</span> <span class="st">"multivariate"</span>,</span>
<span>        func <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>        apply_func_to <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_iter <span class="op">=</span> <span class="va">max_iter</span>, tol <span class="op">=</span> <span class="fl">1e-2</span><span class="op">)</span>,</span>
<span>        parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        num_cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>        return_fit <span class="op">=</span> <span class="va">return_fit</span>,</span>
<span>        collect_diagnostics <span class="op">=</span> <span class="va">collect_diagnostics</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">boot_result</span><span class="op">$</span><span class="va">func_outs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        diagnostics <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">collect_diagnostics</span> <span class="op">&amp;&amp;</span> <span class="va">return_fit</span><span class="op">)</span> <span class="va">boot_result</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">diagnostics</span> <span class="kw">else</span> <span class="cn">NULL</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"CGARCH bootstrap failed at rebalance "</span>, <span class="va">rb_idx</span>, <span class="st">": "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>      <span class="cn">NULL</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">result_cgarch</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">boot_results_cgarch</span><span class="op">[[</span><span class="va">rb_idx</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result_cgarch</span><span class="op">$</span><span class="va">weights</span></span>
<span>      <span class="va">diagnostics_cgarch</span><span class="op">[[</span><span class="va">rb_idx</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result_cgarch</span><span class="op">$</span><span class="va">diagnostics</span></span>
<span>    <span class="op">}</span></span>
<span>    </span>
<span>    <span class="co">## --- GOGARCH Bootstrap ---</span></span>
<span>    <span class="va">result_gogarch</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="va">boot_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">y_train</span>,</span>
<span>        bs_type <span class="op">=</span> <span class="st">"ms_varma_garch"</span>,</span>
<span>        num_boots <span class="op">=</span> <span class="va">num_boots</span>,</span>
<span>        num_blocks <span class="op">=</span> <span class="fl">15</span>,</span>
<span>        num_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>        spec <span class="op">=</span> <span class="va">spec_gogarch</span>,</span>
<span>        model_type <span class="op">=</span> <span class="st">"multivariate"</span>,</span>
<span>        func <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>        apply_func_to <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>        control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_iter <span class="op">=</span> <span class="va">max_iter</span>, tol <span class="op">=</span> <span class="fl">1e-2</span><span class="op">)</span>,</span>
<span>        parallel <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>        num_cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>        return_fit <span class="op">=</span> <span class="va">return_fit</span>,</span>
<span>        collect_diagnostics <span class="op">=</span> <span class="va">collect_diagnostics</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">boot_result</span><span class="op">$</span><span class="va">func_outs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">w</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        diagnostics <span class="op">=</span> <span class="kw">if</span><span class="op">(</span><span class="va">collect_diagnostics</span> <span class="op">&amp;&amp;</span> <span class="va">return_fit</span><span class="op">)</span> <span class="va">boot_result</span><span class="op">$</span><span class="va">fit</span><span class="op">$</span><span class="va">diagnostics</span> <span class="kw">else</span> <span class="cn">NULL</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"GOGARCH bootstrap failed at rebalance "</span>, <span class="va">rb_idx</span>, <span class="st">": "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>      <span class="cn">NULL</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">result_gogarch</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">boot_results_gogarch</span><span class="op">[[</span><span class="va">rb_idx</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result_gogarch</span><span class="op">$</span><span class="va">weights</span></span>
<span>      <span class="va">diagnostics_gogarch</span><span class="op">[[</span><span class="va">rb_idx</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">result_gogarch</span><span class="op">$</span><span class="va">diagnostics</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">## Calculate returns until next rebalance</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">rb_idx</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rebalance_dates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">next_rb</span> <span class="op">&lt;-</span> <span class="va">rebalance_dates</span><span class="op">[</span><span class="va">rb_idx</span> <span class="op">+</span> <span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">next_rb</span> <span class="op">&lt;-</span> <span class="va">n_total</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">hold_period</span> <span class="op">&lt;-</span> <span class="va">rb_date</span><span class="op">:</span><span class="op">(</span><span class="va">next_rb</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">hold_returns</span> <span class="op">&lt;-</span> <span class="va">y_full</span><span class="op">[</span><span class="va">hold_period</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">strat_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">strategies</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">w</span> <span class="op">&lt;-</span> <span class="va">current_weights</span><span class="op">[[</span><span class="va">strat_name</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="va">port_ret</span> <span class="op">&lt;-</span> <span class="va">hold_returns</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">w</span></span>
<span>    <span class="va">result_idx</span> <span class="op">&lt;-</span> <span class="va">hold_period</span> <span class="op">-</span> <span class="va">train_window</span></span>
<span>    <span class="va">backtest_returns</span><span class="op">[</span><span class="va">result_idx</span>, <span class="va">strat_name</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">port_ret</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/txtProgressBar.html" class="external-link">setTxtProgressBar</a></span><span class="op">(</span><span class="va">pb</span>, <span class="va">rb_idx</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">close</a></span><span class="op">(</span><span class="va">pb</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nBacktest completed!\n"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="part-6-backtest-results">Part 6: Backtest Results<a class="anchor" aria-label="anchor" href="#part-6-backtest-results"></a>
</h2>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## BACKTEST RESULTS</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Remove NA rows</span></span>
<span><span class="va">backtest_returns</span> <span class="op">&lt;-</span> <span class="va">backtest_returns</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">backtest_returns</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co">## Calculate performance metrics</span></span>
<span><span class="va">perf_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">backtest_returns</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">strat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ret</span> <span class="op">&lt;-</span> <span class="va">backtest_returns</span><span class="op">[</span>, <span class="va">strat</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="va">ann_ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span> <span class="op">*</span> <span class="fl">252</span></span>
<span>  <span class="va">ann_vol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">252</span><span class="op">)</span></span>
<span>  <span class="va">sharpe</span> <span class="op">&lt;-</span> <span class="va">ann_ret</span> <span class="op">/</span> <span class="va">ann_vol</span></span>
<span>  </span>
<span>  <span class="va">cum_ret</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumprod</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">ret</span><span class="op">/</span><span class="fl">100</span><span class="op">)</span></span>
<span>  <span class="va">rolling_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cummax</a></span><span class="op">(</span><span class="va">cum_ret</span><span class="op">)</span></span>
<span>  <span class="va">max_dd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="op">(</span><span class="va">cum_ret</span> <span class="op">-</span> <span class="va">rolling_max</span><span class="op">)</span> <span class="op">/</span> <span class="va">rolling_max</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"Ann.Return(%)"</span> <span class="op">=</span> <span class="va">ann_ret</span>,</span>
<span>    <span class="st">"Ann.Vol(%)"</span> <span class="op">=</span> <span class="va">ann_vol</span>,</span>
<span>    <span class="st">"Sharpe"</span> <span class="op">=</span> <span class="va">sharpe</span>,</span>
<span>    <span class="st">"MaxDD(%)"</span> <span class="op">=</span> <span class="va">max_dd</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Out-of-sample performance:</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">perf_summary</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 Ann.Return(%) Ann.Vol(%) Sharpe MaxDD(%)</span></span>
<span><span class="co">## Equal Weight            8.644     13.059  0.662  -25.572</span></span>
<span><span class="co">## Min Variance            3.893      6.977  0.558  -18.959</span></span>
<span><span class="co">## Max Sharpe              3.893      6.977  0.558  -18.959</span></span>
<span><span class="co">## Risk Parity             5.662      9.256  0.612  -20.104</span></span>
<span><span class="co">## Black-Litterman         8.644     13.059  0.662  -25.572</span></span>
<span><span class="co">## Shrinkage               8.644     13.059  0.662  -25.572</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best_sharpe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">perf_summary</span><span class="op">[</span>, <span class="st">"Sharpe"</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Best Sharpe ratio: Equal Weight = 0.662</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="part-7-multi-model-bootstrap-comparison">Part 7: Multi-Model Bootstrap Comparison<a class="anchor" aria-label="anchor" href="#part-7-multi-model-bootstrap-comparison"></a>
</h2>
<p>This section compares the uncertainty estimates from DCC, CGARCH, and
GOGARCH models.</p>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<pre><code><span><span class="co">## MULTI-MODEL BOOTSTRAP COMPARISON</span></span></code></pre>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Safe list access function - returns NULL if index doesn't exist</span></span>
<span><span class="va">safe_get</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lst</span>, <span class="va">idx</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lst</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="va">idx</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">lst</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">lst</span><span class="op">[[</span><span class="va">idx</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Use package utility for summarizing bootstrap outputs</span></span>
<span><span class="co">## summarize_func_outs() from bootstrap_diagnostics.R provides CI summaries</span></span>
<span><span class="co">## Here we create a thin wrapper for portfolio weight naming</span></span>
<span><span class="va">summarize_boot_weights</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">boot_w</span>, <span class="va">symbols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Use package utility (or inline if not yet available)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"summarize_func_outs"</span>, mode <span class="op">=</span> <span class="st">"function"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_func_outs.html">summarize_func_outs</a></span><span class="op">(</span><span class="va">boot_w</span>, names <span class="op">=</span> <span class="va">symbols</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Asset"</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">## Fallback implementation</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">symbols</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Asset <span class="op">=</span> <span class="va">symbols</span>,</span>
<span>    Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    SD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    CI_Lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fl">0.025</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    CI_Upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fl">0.975</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>    CI_Width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fl">0.975</span><span class="op">)</span> <span class="op">-</span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fl">0.025</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Count successful models</span></span>
<span><span class="va">n_dcc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">boot_results_dcc</span><span class="op">)</span></span>
<span><span class="va">n_cgarch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">boot_results_cgarch</span><span class="op">)</span></span>
<span><span class="va">n_gogarch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">boot_results_gogarch</span><span class="op">)</span></span>
<span><span class="va">models_succeeded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>DCC <span class="op">=</span> <span class="va">n_dcc</span> <span class="op">&gt;</span> <span class="fl">0</span>, CGARCH <span class="op">=</span> <span class="va">n_cgarch</span> <span class="op">&gt;</span> <span class="fl">0</span>, GOGARCH <span class="op">=</span> <span class="va">n_gogarch</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">n_models_ok</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">models_succeeded</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Model estimation summary:</span></span></code></pre>
<pre><code><span><span class="co">##   DCC:      3 rebalance(s) completed</span></span></code></pre>
<pre><code><span><span class="co">##   CGARCH:   3 rebalance(s) completed</span></span></code></pre>
<pre><code><span><span class="co">##   GOGARCH:  3 rebalance(s) completed</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## --- First Rebalance Weight Comparison ---</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_dcc</span> <span class="op">&lt;-</span> <span class="fu">summarize_boot_weights</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_dcc</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">symbols</span><span class="op">)</span></span>
<span><span class="va">summary_cgarch</span> <span class="op">&lt;-</span> <span class="fu">summarize_boot_weights</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_cgarch</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">symbols</span><span class="op">)</span></span>
<span><span class="va">summary_gogarch</span> <span class="op">&lt;-</span> <span class="fu">summarize_boot_weights</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_gogarch</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">symbols</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Collect available summaries for flexible comparison</span></span>
<span><span class="va">available_summaries</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">summary_dcc</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nDCC Model:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">summary_dcc</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">available_summaries</span><span class="op">[[</span><span class="st">"DCC"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">summary_dcc</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## DCC Model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset |   Mean|     SD| CI_Lower| CI_Upper| CI_Width|</span></span>
<span><span class="co">## |:-----|------:|------:|--------:|--------:|--------:|</span></span>
<span><span class="co">## |SPY   | 0.0713| 0.0207|   0.0374|   0.1138|   0.0764|</span></span>
<span><span class="co">## |EFA   | 0.0825| 0.0197|   0.0458|   0.1100|   0.0642|</span></span>
<span><span class="co">## |BND   | 0.6157| 0.0413|   0.5340|   0.6745|   0.1405|</span></span>
<span><span class="co">## |GLD   | 0.1565| 0.0427|   0.1067|   0.2447|   0.1380|</span></span>
<span><span class="co">## |VNQ   | 0.0740| 0.0142|   0.0562|   0.1018|   0.0457|</span></span></code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">summary_cgarch</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nCGARCH Model:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">summary_cgarch</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">available_summaries</span><span class="op">[[</span><span class="st">"CGARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">summary_cgarch</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## CGARCH Model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset |   Mean|     SD| CI_Lower| CI_Upper| CI_Width|</span></span>
<span><span class="co">## |:-----|------:|------:|--------:|--------:|--------:|</span></span>
<span><span class="co">## |SPY   | 0.0701| 0.0113|   0.0534|   0.0912|   0.0378|</span></span>
<span><span class="co">## |EFA   | 0.0803| 0.0112|   0.0626|   0.1018|   0.0392|</span></span>
<span><span class="co">## |BND   | 0.6203| 0.0347|   0.5704|   0.6868|   0.1164|</span></span>
<span><span class="co">## |GLD   | 0.1588| 0.0208|   0.1266|   0.1981|   0.0716|</span></span>
<span><span class="co">## |VNQ   | 0.0705| 0.0074|   0.0567|   0.0825|   0.0258|</span></span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">summary_gogarch</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nGOGARCH Model:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">summary_gogarch</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">available_summaries</span><span class="op">[[</span><span class="st">"GOGARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">summary_gogarch</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## GOGARCH Model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset |   Mean|     SD| CI_Lower| CI_Upper| CI_Width|</span></span>
<span><span class="co">## |:-----|------:|------:|--------:|--------:|--------:|</span></span>
<span><span class="co">## |SPY   | 0.0726| 0.0304|   0.0337|   0.1596|   0.1259|</span></span>
<span><span class="co">## |EFA   | 0.0849| 0.0351|   0.0388|   0.1734|   0.1346|</span></span>
<span><span class="co">## |BND   | 0.5872| 0.1674|   0.0000|   0.7061|   0.7061|</span></span>
<span><span class="co">## |GLD   | 0.1767| 0.0845|   0.1075|   0.4677|   0.3602|</span></span>
<span><span class="co">## |VNQ   | 0.0785| 0.0366|   0.0383|   0.1930|   0.1547|</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Compare uncertainty across available models (works with 2+ models)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">available_summaries</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- Model Uncertainty Comparison (CI Width) ---\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">uncertainty_comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Asset <span class="op">=</span> <span class="va">symbols</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">model_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">available_summaries</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">uncertainty_comparison</span><span class="op">[[</span><span class="va">model_name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">available_summaries</span><span class="op">[[</span><span class="va">model_name</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CI_Width</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">uncertainty_comparison</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nAverage CI Width by Model:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">model_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">available_summaries</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  "</span>, <span class="va">model_name</span>, <span class="st">": "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">available_summaries</span><span class="op">[[</span><span class="va">model_name</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CI_Width</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">available_summaries</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nOnly one model converged - cross-model comparison not available.\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"The"</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">available_summaries</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"model shows average CI width of"</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">available_summaries</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">CI_Width</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## --- Model Uncertainty Comparison (CI Width) ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset |    DCC| CGARCH| GOGARCH|</span></span>
<span><span class="co">## |:-----|------:|------:|-------:|</span></span>
<span><span class="co">## |SPY   | 0.0764| 0.0378|  0.1259|</span></span>
<span><span class="co">## |EFA   | 0.0642| 0.0392|  0.1346|</span></span>
<span><span class="co">## |BND   | 0.1405| 0.1164|  0.7061|</span></span>
<span><span class="co">## |GLD   | 0.1380| 0.0716|  0.3602|</span></span>
<span><span class="co">## |VNQ   | 0.0457| 0.0258|  0.1547|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average CI Width by Model:</span></span>
<span><span class="co">##   DCC: 0.093</span></span>
<span><span class="co">##   CGARCH: 0.0582</span></span>
<span><span class="co">##   GOGARCH: 0.2963</span></span></code></pre>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## =============================================================================</span></span>
<span><span class="co">## VISUALIZATION: Multi-Model Weight Comparison</span></span>
<span><span class="co">## =============================================================================</span></span>
<span></span>
<span><span class="co">## Prepare data for plotting</span></span>
<span><span class="va">prepare_boot_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">boot_w</span>, <span class="va">model_name</span>, <span class="va">symbols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">symbols</span></span>
<span>  </span>
<span>  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span>,</span>
<span>    Asset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Model <span class="op">=</span> <span class="va">model_name</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">df</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Combine data from all available models</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span></span>
<span>  <span class="fu">prepare_boot_data</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_dcc</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"DCC"</span>, <span class="va">symbols</span><span class="op">)</span>,</span>
<span>  <span class="fu">prepare_boot_data</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_cgarch</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"CGARCH"</span>, <span class="va">symbols</span><span class="op">)</span>,</span>
<span>  <span class="fu">prepare_boot_data</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_gogarch</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"GOGARCH"</span>, <span class="va">symbols</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## Determine which models are in the data for proper coloring</span></span>
<span>  <span class="va">models_in_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">Model</span><span class="op">)</span></span>
<span>  <span class="va">model_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DCC"</span> <span class="op">=</span> <span class="st">"#E41A1C"</span>, <span class="st">"CGARCH"</span> <span class="op">=</span> <span class="st">"#377EB8"</span>, <span class="st">"GOGARCH"</span> <span class="op">=</span> <span class="st">"#4DAF4A"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Create subtitle based on available models</span></span>
<span>  <span class="va">n_models_plotted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">models_in_data</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">n_models_plotted</span> <span class="op">==</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">plot_subtitle</span> <span class="op">&lt;-</span> <span class="st">"Risk Parity Portfolio - Comparing all three correlation models"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">n_models_plotted</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">plot_subtitle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Risk Parity Portfolio - Comparing"</span>, </span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">models_in_data</span>, collapse <span class="op">=</span> <span class="st">" and "</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">plot_subtitle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Risk Parity Portfolio -"</span>, <span class="va">models_in_data</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"model only"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Asset</span>, y <span class="op">=</span> <span class="va">Weight</span>, fill <span class="op">=</span> <span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span>, position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_dodge.html" class="external-link">position_dodge</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">model_colors</span><span class="op">[</span><span class="va">models_in_data</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"Bootstrap Weight Distributions by Model Type"</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="va">plot_subtitle</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Weight"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p1</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No bootstrap results available for plotting.\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"This may occur if all models failed to converge.\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Try increasing max_iter or train_window in the global settings.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/model_comparison_plot-1.png" class="r-plt" alt="" width="1152"></p>
</div>
<div class="section level2">
<h2 id="part-8-bootstrap-diagnostics">Part 8: Bootstrap Diagnostics<a class="anchor" aria-label="anchor" href="#part-8-bootstrap-diagnostics"></a>
</h2>
<p>The <strong>tsbs</strong> package provides a comprehensive
diagnostics system through <code>bootstrap_diagnostics.R</code>. The
<code>tsbs_diagnostics</code> class captures detailed information about
how bootstrap series are constructed, enabling quality assessment and
visualization.</p>
<div class="section level3">
<h3 id="diagnostic-system-overview">Diagnostic System Overview<a class="anchor" aria-label="anchor" href="#diagnostic-system-overview"></a>
</h3>
<p>Key functions in the diagnostics system:</p>
<table class="table">
<colgroup>
<col width="52%">
<col width="47%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Purpose</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/compute_bootstrap_diagnostics.html">compute_bootstrap_diagnostics()</a></code></td>
<td>Create diagnostics from bootstrap output</td>
</tr>
<tr class="even">
<td><code><a href="../reference/summary.tsbs_diagnostics.html">summary.tsbs_diagnostics()</a></code></td>
<td>Print comprehensive summary</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/plot.tsbs_diagnostics.html">plot.tsbs_diagnostics()</a></code></td>
<td>Visualize block lengths, coverage, statistics</td>
</tr>
<tr class="even">
<td><code><a href="../reference/extract_blocks.html">extract_blocks()</a></code></td>
<td>Extract block-level information</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/extract_summary_stats.html">extract_summary_stats()</a></code></td>
<td>Get statistical summaries</td>
</tr>
</tbody>
</table>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<pre><code><span><span class="co">## BOOTSTRAP DIAGNOSTICS SYSTEM</span></span></code></pre>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="computing-diagnostics-from-bootstrap-output">Computing Diagnostics from Bootstrap Output<a class="anchor" aria-label="anchor" href="#computing-diagnostics-from-bootstrap-output"></a>
</h3>
<p>We use <code><a href="../reference/compute_bootstrap_diagnostics.html">compute_bootstrap_diagnostics()</a></code> to analyze how
each bootstrap method samples from the original data.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run bootstrap methods and compute diagnostics</span></span>
<span><span class="co">## (Using smaller num_boots for demo speed)</span></span>
<span><span class="va">num_boots_diag</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="co">## --- Moving Block Bootstrap ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Running Moving Block bootstrap for diagnostics...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running Moving Block bootstrap for diagnostics...</span></span></code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moving_bs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">y_train</span>,</span>
<span>  bs_type <span class="op">=</span> <span class="st">"moving"</span>,</span>
<span>  block_length <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  num_boots <span class="op">=</span> <span class="va">num_boots_diag</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">moving_diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_bootstrap_diagnostics.html">compute_bootstrap_diagnostics</a></span><span class="op">(</span></span>
<span>  bootstrap_series <span class="op">=</span> <span class="va">moving_bs</span><span class="op">$</span><span class="va">bootstrap_series</span>,</span>
<span>  original_data <span class="op">=</span> <span class="va">y_train</span>,</span>
<span>  bs_type <span class="op">=</span> <span class="st">"moving"</span>,</span>
<span>  config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>block_length <span class="op">=</span> <span class="fl">10</span>, block_type <span class="op">=</span> <span class="st">"overlapping"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## --- Stationary Block Bootstrap ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Running Stationary Block bootstrap for diagnostics...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running Stationary Block bootstrap for diagnostics...</span></span></code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stationary_bs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">y_train</span>,</span>
<span>  bs_type <span class="op">=</span> <span class="st">"stationary"</span>,</span>
<span>  num_boots <span class="op">=</span> <span class="va">num_boots_diag</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">stationary_diag</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_bootstrap_diagnostics.html">compute_bootstrap_diagnostics</a></span><span class="op">(</span></span>
<span>  bootstrap_series <span class="op">=</span> <span class="va">stationary_bs</span><span class="op">$</span><span class="va">bootstrap_series</span>,</span>
<span>  original_data <span class="op">=</span> <span class="va">y_train</span>,</span>
<span>  bs_type <span class="op">=</span> <span class="st">"stationary"</span>,</span>
<span>  config <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>p <span class="op">=</span> <span class="fl">0.1</span>, block_type <span class="op">=</span> <span class="st">"overlapping"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summary-method-summary-tsbs_diagnostics">Summary Method: <code>summary.tsbs_diagnostics()</code><a class="anchor" aria-label="anchor" href="#summary-method-summary-tsbs_diagnostics"></a>
</h3>
<p>The <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> method provides a comprehensive overview
of bootstrap characteristics.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- Moving Block Bootstrap Diagnostics ---\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## --- Moving Block Bootstrap Diagnostics ---</span></span></code></pre>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">moving_diag</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 Length Class  Mode</span></span>
<span><span class="co">## meta            5      -none- list</span></span>
<span><span class="co">## blocks          3      -none- list</span></span>
<span><span class="co">## series_stats    4      -none- list</span></span>
<span><span class="co">## original_stats  3      -none- list</span></span>
<span><span class="co">## method_specific 0      -none- list</span></span>
<span><span class="co">## config          2      -none- list</span></span></code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- Stationary Block Bootstrap Diagnostics ---\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## --- Stationary Block Bootstrap Diagnostics ---</span></span></code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">stationary_diag</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                 Length Class  Mode</span></span>
<span><span class="co">## meta            5      -none- list</span></span>
<span><span class="co">## blocks          3      -none- list</span></span>
<span><span class="co">## series_stats    4      -none- list</span></span>
<span><span class="co">## original_stats  3      -none- list</span></span>
<span><span class="co">## method_specific 0      -none- list</span></span>
<span><span class="co">## config          2      -none- list</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="plot-method-plot-tsbs_diagnostics">Plot Method: <code>plot.tsbs_diagnostics()</code><a class="anchor" aria-label="anchor" href="#plot-method-plot-tsbs_diagnostics"></a>
</h3>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> method creates diagnostic visualizations.
Available plot types include:</p>
<ul>
<li>
<code>"block_lengths"</code> - Distribution of block lengths</li>
<li>
<code>"start_positions"</code> - Where blocks were sampled from</li>
<li>
<code>"means_comparison"</code> - Original vs bootstrap means</li>
<li>
<code>"acf_comparison"</code> - Original vs bootstrap
autocorrelation</li>
</ul>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Block length comparison</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Moving Block - should show fixed block length</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">moving_diag</span>, type <span class="op">=</span> <span class="st">"block_lengths"</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/plot_diagnostics_blocks-1.png" class="r-plt" alt="" width="1152"></p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Stationary - should show geometric distribution</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stationary_diag</span>, type <span class="op">=</span> <span class="st">"block_lengths"</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/plot_diagnostics_blocks-2.png" class="r-plt" alt="" width="1152"></p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Starting position distributions - assess coverage uniformity</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">moving_diag</span>, type <span class="op">=</span> <span class="st">"start_positions"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stationary_diag</span>, type <span class="op">=</span> <span class="st">"start_positions"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Compare original vs bootstrap means</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">moving_diag</span>, type <span class="op">=</span> <span class="st">"means_comparison"</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/plot_diagnostics_means-1.png" class="r-plt" alt="" width="1152"></p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">stationary_diag</span>, type <span class="op">=</span> <span class="st">"means_comparison"</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/plot_diagnostics_means-2.png" class="r-plt" alt="" width="1152"></p>
</div>
<div class="section level3">
<h3 id="extraction-functions">Extraction Functions<a class="anchor" aria-label="anchor" href="#extraction-functions"></a>
</h3>
<p>Use <code><a href="../reference/extract_blocks.html">extract_blocks()</a></code> and
<code><a href="../reference/extract_summary_stats.html">extract_summary_stats()</a></code> to access diagnostic data
programmatically.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract block information</span></span>
<span><span class="va">blocks_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_blocks.html">extract_blocks</a></span><span class="op">(</span><span class="va">moving_diag</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- Block Information (first 10 rows) ---\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## --- Block Information (first 10 rows) ---</span></span></code></pre>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">blocks_df</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## | block_num| length| start_pos|block_type | replicate|</span></span>
<span><span class="co">## |---------:|------:|---------:|:----------|---------:|</span></span>
<span><span class="co">## |         1|     10|       228|estimated  |         1|</span></span>
<span><span class="co">## |         2|     10|        63|estimated  |         1|</span></span>
<span><span class="co">## |         3|     10|       113|estimated  |         1|</span></span>
<span><span class="co">## |         4|     10|       229|estimated  |         1|</span></span>
<span><span class="co">## |         5|     10|       238|estimated  |         1|</span></span>
<span><span class="co">## |         6|     10|        29|estimated  |         1|</span></span>
<span><span class="co">## |         7|     10|       116|estimated  |         1|</span></span>
<span><span class="co">## |         8|     10|       137|estimated  |         1|</span></span>
<span><span class="co">## |         9|     10|       220|estimated  |         1|</span></span>
<span><span class="co">## |        10|     10|        34|estimated  |         1|</span></span></code></pre>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- Blocks per replicate ---\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## --- Blocks per replicate ---</span></span></code></pre>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">blocks_per_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">blocks_df</span><span class="op">$</span><span class="va">replicate</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean blocks per replicate:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">blocks_per_rep</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Mean blocks per replicate: 25.8</span></span></code></pre>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Range:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">blocks_per_rep</span><span class="op">)</span>, <span class="st">"-"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">blocks_per_rep</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Range: 24 - 26</span></span></code></pre>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract summary statistics</span></span>
<span><span class="va">stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_summary_stats.html">extract_summary_stats</a></span><span class="op">(</span><span class="va">stationary_diag</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- Block Length Statistics (Stationary Bootstrap) ---\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## --- Block Length Statistics (Stationary Bootstrap) ---</span></span></code></pre>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Mean:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">stats</span><span class="op">$</span><span class="va">block_lengths</span><span class="op">$</span><span class="va">mean</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Mean: 8.74</span></span></code></pre>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"SD:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">stats</span><span class="op">$</span><span class="va">block_lengths</span><span class="op">$</span><span class="va">sd</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## SD: 7.16</span></span></code></pre>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Median:"</span>, <span class="va">stats</span><span class="op">$</span><span class="va">block_lengths</span><span class="op">$</span><span class="va">median</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Median: 7</span></span></code></pre>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Range: ["</span>, <span class="va">stats</span><span class="op">$</span><span class="va">block_lengths</span><span class="op">$</span><span class="va">min</span>, <span class="st">", "</span>, <span class="va">stats</span><span class="op">$</span><span class="va">block_lengths</span><span class="op">$</span><span class="va">max</span>, <span class="st">"]\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Range: [1, 26]</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="converting-to-data-frame">Converting to Data Frame<a class="anchor" aria-label="anchor" href="#converting-to-data-frame"></a>
</h3>
<p>The <code><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame()</a></code> method converts diagnostics to
tabular format for further analysis.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Convert to data frame</span></span>
<span><span class="va">diag_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">moving_diag</span>, what <span class="op">=</span> <span class="st">"stats"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- Replicate-Level Statistics (first 5) ---\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## --- Replicate-Level Statistics (first 5) ---</span></span></code></pre>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">diag_df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">diag_df</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## | replicate| length|   mean_V1|   mean_V2|    mean_V3|   mean_V4|</span></span>
<span><span class="co">## |---------:|------:|---------:|---------:|----------:|---------:|</span></span>
<span><span class="co">## |         1|    252| 0.1422454| 0.0822370|  0.0434188| 0.0718100|</span></span>
<span><span class="co">## |         2|    252| 0.1017265| 0.0491111|  0.0039536| 0.1242997|</span></span>
<span><span class="co">## |         3|    252| 0.0518437| 0.0068736| -0.0235662| 0.0466279|</span></span>
<span><span class="co">## |         4|    252| 0.1177195| 0.0227660|  0.0074257| 0.1277827|</span></span>
<span><span class="co">## |         5|    252| 0.1911900| 0.1350689|  0.0469621| 0.0756198|</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="ms-varma-garch-model-diagnostics">MS-VARMA-GARCH Model Diagnostics<a class="anchor" aria-label="anchor" href="#ms-varma-garch-model-diagnostics"></a>
</h3>
<p>For MS-VARMA-GARCH models, the <code>ms_diagnostics</code> class
provides additional information about EM algorithm convergence.</p>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Display MS-VARMA-GARCH diagnostics from earlier fitting</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">model_info</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"DCC"</span>, diag <span class="op">=</span> <span class="fu">safe_get</span><span class="op">(</span><span class="va">diagnostics_dcc</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"CGARCH"</span>, diag <span class="op">=</span> <span class="fu">safe_get</span><span class="op">(</span><span class="va">diagnostics_cgarch</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"GOGARCH"</span>, diag <span class="op">=</span> <span class="fu">safe_get</span><span class="op">(</span><span class="va">diagnostics_gogarch</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- "</span>, <span class="va">model_info</span><span class="op">$</span><span class="va">name</span>, <span class="st">" Model ---\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">model_info</span><span class="op">$</span><span class="va">diag</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"No diagnostics available\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">model_info</span><span class="op">$</span><span class="va">diag</span>, <span class="st">"ms_diagnostics"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_info</span><span class="op">$</span><span class="va">diag</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Diagnostic class:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">model_info</span><span class="op">$</span><span class="va">diag</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## --- DCC Model ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- CGARCH Model ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- GOGARCH Model ---</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="weight-stability-analysis">Weight Stability Analysis<a class="anchor" aria-label="anchor" href="#weight-stability-analysis"></a>
</h3>
<p>We analyze how stable portfolio weights are across bootstrap
replicates using the coefficient of variation (CV).</p>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## WEIGHT STABILITY ANALYSIS</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## CV-based stability classification</span></span>
<span><span class="va">calc_cv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">boot_w</span>, <span class="va">model_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">boot_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span></span>
<span>  <span class="va">boot_sd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span></span>
<span>  <span class="va">cv</span> <span class="op">&lt;-</span> <span class="va">boot_sd</span> <span class="op">/</span> <span class="op">(</span><span class="va">boot_mean</span> <span class="op">+</span> <span class="fl">1e-8</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">stability</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">cv</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0.3</span><span class="op">)</span> <span class="st">"Stable"</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0.6</span><span class="op">)</span> <span class="st">"Moderate"</span> <span class="kw">else</span> <span class="st">"Unstable"</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Model <span class="op">=</span> <span class="va">model_name</span>,</span>
<span>    Asset <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"V"</span>, <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    CV <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cv</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    Stability <span class="op">=</span> <span class="va">stability</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">stability_dcc</span> <span class="op">&lt;-</span> <span class="fu">calc_cv</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_dcc</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"DCC"</span><span class="op">)</span></span>
<span><span class="va">stability_cgarch</span> <span class="op">&lt;-</span> <span class="fu">calc_cv</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_cgarch</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"CGARCH"</span><span class="op">)</span></span>
<span><span class="va">stability_gogarch</span> <span class="op">&lt;-</span> <span class="fu">calc_cv</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_gogarch</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"GOGARCH"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">stability_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">stability_dcc</span>, <span class="va">stability_cgarch</span>, <span class="va">stability_gogarch</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">stability_all</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">stability_all</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n_models_in_stability</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">stability_all</span><span class="op">$</span><span class="va">Model</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^V"</span>, <span class="va">stability_all</span><span class="op">$</span><span class="va">Asset</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">stability_all</span><span class="op">$</span><span class="va">Asset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">symbols</span>, <span class="va">n_models_in_stability</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nWeight Stability by Model (CV = Coefficient of Variation):\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  CV &lt; 0.3: Stable | CV 0.3-0.6: Moderate | CV &gt; 0.6: Unstable\n\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">stability_all</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nStability Summary by Model:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">model</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">stability_all</span><span class="op">$</span><span class="va">Model</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">model_data</span> <span class="op">&lt;-</span> <span class="va">stability_all</span><span class="op">[</span><span class="va">stability_all</span><span class="op">$</span><span class="va">Model</span> <span class="op">==</span> <span class="va">model</span>, <span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s: Mean CV = %.3f, %d Stable, %d Moderate, %d Unstable\n"</span>,</span>
<span>                <span class="va">model</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">model_data</span><span class="op">$</span><span class="va">CV</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">model_data</span><span class="op">$</span><span class="va">Stability</span> <span class="op">==</span> <span class="st">"Stable"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">model_data</span><span class="op">$</span><span class="va">Stability</span> <span class="op">==</span> <span class="st">"Moderate"</span><span class="op">)</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">model_data</span><span class="op">$</span><span class="va">Stability</span> <span class="op">==</span> <span class="st">"Unstable"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">## Interpretation</span></span>
<span>  <span class="va">avg_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">stability_all</span><span class="op">$</span><span class="va">CV</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nInterpretation:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">avg_cv</span> <span class="op">&lt;</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Overall weight estimates are stable across bootstrap replicates.\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  The portfolio optimization is well-identified for this data.\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">avg_cv</span> <span class="op">&lt;</span> <span class="fl">0.6</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Weight estimates show moderate variability across bootstrap replicates.\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Consider using robust estimates (median or winsorized mean).\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Weight estimates are highly variable across bootstrap replicates.\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  The optimization may be sensitive to estimation uncertainty.\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  Consider regularized methods or increasing the training window.\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nNo stability analysis available - no models converged.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Weight Stability by Model (CV = Coefficient of Variation):</span></span>
<span><span class="co">##   CV &lt; 0.3: Stable | CV 0.3-0.6: Moderate | CV &gt; 0.6: Unstable</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Model   |Asset |    CV|Stability |</span></span>
<span><span class="co">## |:-------|:-----|-----:|:---------|</span></span>
<span><span class="co">## |DCC     |SPY   | 0.291|Stable    |</span></span>
<span><span class="co">## |DCC     |EFA   | 0.239|Stable    |</span></span>
<span><span class="co">## |DCC     |BND   | 0.067|Stable    |</span></span>
<span><span class="co">## |DCC     |GLD   | 0.273|Stable    |</span></span>
<span><span class="co">## |DCC     |VNQ   | 0.192|Stable    |</span></span>
<span><span class="co">## |CGARCH  |SPY   | 0.162|Stable    |</span></span>
<span><span class="co">## |CGARCH  |EFA   | 0.139|Stable    |</span></span>
<span><span class="co">## |CGARCH  |BND   | 0.056|Stable    |</span></span>
<span><span class="co">## |CGARCH  |GLD   | 0.131|Stable    |</span></span>
<span><span class="co">## |CGARCH  |VNQ   | 0.105|Stable    |</span></span>
<span><span class="co">## |GOGARCH |SPY   | 0.418|Moderate  |</span></span>
<span><span class="co">## |GOGARCH |EFA   | 0.413|Moderate  |</span></span>
<span><span class="co">## |GOGARCH |BND   | 0.285|Stable    |</span></span>
<span><span class="co">## |GOGARCH |GLD   | 0.478|Moderate  |</span></span>
<span><span class="co">## |GOGARCH |VNQ   | 0.466|Moderate  |</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Stability Summary by Model:</span></span>
<span><span class="co">##   DCC: Mean CV = 0.212, 5 Stable, 0 Moderate, 0 Unstable</span></span>
<span><span class="co">##   CGARCH: Mean CV = 0.119, 5 Stable, 0 Moderate, 0 Unstable</span></span>
<span><span class="co">##   GOGARCH: Mean CV = 0.412, 1 Stable, 4 Moderate, 0 Unstable</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Interpretation:</span></span>
<span><span class="co">##   Overall weight estimates are stable across bootstrap replicates.</span></span>
<span><span class="co">##   The portfolio optimization is well-identified for this data.</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="part-9-performance-visualizations">Part 9: Performance Visualizations<a class="anchor" aria-label="anchor" href="#part-9-performance-visualizations"></a>
</h2>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## =============================================================================</span></span>
<span><span class="co">## CUMULATIVE RETURNS</span></span>
<span><span class="co">## =============================================================================</span></span>
<span></span>
<span><span class="va">cum_returns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">backtest_returns</span><span class="op">/</span><span class="fl">100</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumprod</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">cum_returns</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">cum_returns</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Cumulative Returns (Out-of-Sample)"</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Days"</span>, ylab <span class="op">=</span> <span class="st">"Growth of $1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cum_returns</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">cum_returns</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, cex <span class="op">=</span> <span class="fl">0.7</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/cumulative_returns-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## =============================================================================</span></span>
<span><span class="co">## ROLLING SHARPE RATIO</span></span>
<span><span class="co">## =============================================================================</span></span>
<span></span>
<span><span class="va">roll_sharpe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ret</span>, <span class="va">window</span> <span class="op">=</span> <span class="fl">252</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ret</span><span class="op">)</span></span>
<span>  <span class="va">sharpe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="va">n</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">window</span><span class="op">:</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">ret</span><span class="op">[</span><span class="op">(</span><span class="va">i</span><span class="op">-</span><span class="va">window</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="va">i</span><span class="op">]</span></span>
<span>    <span class="va">sharpe</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">252</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">sharpe</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sharpe_ts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">backtest_returns</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">roll_sharpe</span><span class="op">(</span><span class="va">backtest_returns</span><span class="op">[</span>, <span class="va">s</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/matplot.html" class="external-link">matplot</a></span><span class="op">(</span><span class="va">sharpe_ts</span>, type <span class="op">=</span> <span class="st">"l"</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">sharpe_ts</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        main <span class="op">=</span> <span class="st">"Rolling 1-Year Sharpe Ratio"</span>,</span>
<span>        xlab <span class="op">=</span> <span class="st">"Days"</span>, ylab <span class="op">=</span> <span class="st">"Sharpe Ratio"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">sharpe_ts</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">sharpe_ts</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">1</span>, cex <span class="op">=</span> <span class="fl">0.6</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/rolling_sharpe-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## =============================================================================</span></span>
<span><span class="co">## WEIGHT EVOLUTION OVER TIME</span></span>
<span><span class="co">## =============================================================================</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">strat_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weight_history</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">w_hist</span> <span class="op">&lt;-</span> <span class="va">weight_history</span><span class="op">[[</span><span class="va">strat_name</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">w_hist</span> <span class="op">&lt;-</span> <span class="va">w_hist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">w_hist</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">w_hist</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">w_hist</span><span class="op">)</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span>, border <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>            main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">strat_name</span>, <span class="st">"Weights"</span><span class="op">)</span>,</span>
<span>            xlab <span class="op">=</span> <span class="st">"Rebalance Period"</span>, ylab <span class="op">=</span> <span class="st">"Weight"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/weight_evolution-1.png" class="r-plt" alt="" width="1152"></p>
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add legend</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/frame.html" class="external-link">plot.new</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="va">symbols</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="va">k</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">symbols</span><span class="op">)</span>, </span>
<span>       title <span class="op">=</span> <span class="st">"Assets"</span>, bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/weight_evolution-2.png" class="r-plt" alt="" width="1152"></p>
</div>
<div class="section level2">
<h2 id="part-10-portfolio-performance-uncertainty">Part 10: Portfolio Performance Uncertainty<a class="anchor" aria-label="anchor" href="#part-10-portfolio-performance-uncertainty"></a>
</h2>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## PORTFOLIO PERFORMANCE UNCERTAINTY BY MODEL</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate expected performance for each bootstrap weight set</span></span>
<span><span class="va">calc_boot_performance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">boot_w</span>, <span class="va">hold_returns</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">boot_perf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">w</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">port_ret</span> <span class="op">&lt;-</span> <span class="va">hold_returns</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">w</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      Ann_Return <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">port_ret</span><span class="op">)</span> <span class="op">*</span> <span class="fl">252</span>,</span>
<span>      Ann_Vol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">port_ret</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">252</span><span class="op">)</span>,</span>
<span>      Sharpe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">port_ret</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">port_ret</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">252</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">boot_perf</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Get first holding period returns</span></span>
<span><span class="va">rb_date</span> <span class="op">&lt;-</span> <span class="va">rebalance_dates</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">next_rb</span> <span class="op">&lt;-</span> <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rebalance_dates</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="va">rebalance_dates</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="kw">else</span> <span class="va">n_total</span></span>
<span><span class="va">hold_returns</span> <span class="op">&lt;-</span> <span class="va">y_full</span><span class="op">[</span><span class="va">rb_date</span><span class="op">:</span><span class="op">(</span><span class="va">next_rb</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Calculate performance for each model</span></span>
<span><span class="va">perf_dcc</span> <span class="op">&lt;-</span> <span class="fu">calc_boot_performance</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_dcc</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">hold_returns</span><span class="op">)</span></span>
<span><span class="va">perf_cgarch</span> <span class="op">&lt;-</span> <span class="fu">calc_boot_performance</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_cgarch</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">hold_returns</span><span class="op">)</span></span>
<span><span class="va">perf_gogarch</span> <span class="op">&lt;-</span> <span class="fu">calc_boot_performance</span><span class="op">(</span><span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_gogarch</span>, <span class="fl">1</span><span class="op">)</span>, <span class="va">hold_returns</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Print summaries</span></span>
<span><span class="va">print_perf_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">boot_perf</span>, <span class="va">model_name</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">boot_perf</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span>, <span class="va">model_name</span>, <span class="st">": No performance data available\n"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span>, <span class="va">model_name</span>, <span class="st">" Performance Distribution:\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">metric</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">boot_perf</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">ci</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">boot_perf</span><span class="op">[</span>, <span class="va">metric</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"  %s: Median=%.2f, 95%% CI=[%.2f, %.2f]\n"</span>,</span>
<span>                <span class="va">metric</span>, <span class="va">ci</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">ci</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">ci</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Collect available performance results</span></span>
<span><span class="va">available_perf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">model_colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DCC"</span> <span class="op">=</span> <span class="st">"#E41A1C"</span>, <span class="st">"CGARCH"</span> <span class="op">=</span> <span class="st">"#377EB8"</span>, <span class="st">"GOGARCH"</span> <span class="op">=</span> <span class="st">"#4DAF4A"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">perf_dcc</span><span class="op">)</span><span class="op">)</span> <span class="va">available_perf</span><span class="op">[[</span><span class="st">"DCC"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">perf_dcc</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">perf_cgarch</span><span class="op">)</span><span class="op">)</span> <span class="va">available_perf</span><span class="op">[[</span><span class="st">"CGARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">perf_cgarch</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">perf_gogarch</span><span class="op">)</span><span class="op">)</span> <span class="va">available_perf</span><span class="op">[[</span><span class="st">"GOGARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">perf_gogarch</span></span>
<span></span>
<span><span class="co">## Print summaries for available models</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">available_perf</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nPerformance distributions from converged models:\n"</span><span class="op">)</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">model_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">available_perf</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">print_perf_summary</span><span class="op">(</span><span class="va">available_perf</span><span class="op">[[</span><span class="va">model_name</span><span class="op">]</span><span class="op">]</span>, <span class="va">model_name</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nNo performance data available - no models converged.\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Performance distributions from converged models:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## DCC Performance Distribution:</span></span>
<span><span class="co">##   Ann_Return: Median=19.16, 95% CI=[14.76, 23.06]</span></span>
<span><span class="co">##   Ann_Vol: Median=3.01, 95% CI=[2.80, 3.86]</span></span>
<span><span class="co">##   Sharpe: Median=6.45, 95% CI=[4.57, 7.14]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## CGARCH Performance Distribution:</span></span>
<span><span class="co">##   Ann_Return: Median=18.39, 95% CI=[16.31, 21.17]</span></span>
<span><span class="co">##   Ann_Vol: Median=2.99, 95% CI=[2.83, 3.30]</span></span>
<span><span class="co">##   Sharpe: Median=6.00, 95% CI=[5.29, 6.90]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## GOGARCH Performance Distribution:</span></span>
<span><span class="co">##   Ann_Return: Median=18.76, 95% CI=[12.62, 33.18]</span></span>
<span><span class="co">##   Ann_Vol: Median=3.03, 95% CI=[2.79, 6.57]</span></span>
<span><span class="co">##   Sharpe: Median=5.98, 95% CI=[3.82, 7.36]</span></span></code></pre>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Visualization - works with any number of available models</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">available_perf</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Sharpe ratio comparison</span></span>
<span>  <span class="va">sharpe_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">available_perf</span>, <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="va">p</span><span class="op">[</span>, <span class="st">"Sharpe"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">sharpe_data</span>, col <span class="op">=</span> <span class="va">model_colors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">available_perf</span><span class="op">)</span><span class="op">]</span>,</span>
<span>          main <span class="op">=</span> <span class="st">"Bootstrap Sharpe Ratio"</span>,</span>
<span>          ylab <span class="op">=</span> <span class="st">"Sharpe Ratio"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, col <span class="op">=</span> <span class="st">"gray"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Return comparison</span></span>
<span>  <span class="va">return_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">available_perf</span>, <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="va">p</span><span class="op">[</span>, <span class="st">"Ann_Return"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">return_data</span>, col <span class="op">=</span> <span class="va">model_colors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">available_perf</span><span class="op">)</span><span class="op">]</span>,</span>
<span>          main <span class="op">=</span> <span class="st">"Bootstrap Annual Return"</span>,</span>
<span>          ylab <span class="op">=</span> <span class="st">"Annual Return (%)"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Volatility comparison</span></span>
<span>  <span class="va">vol_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">available_perf</span>, <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="va">p</span><span class="op">[</span>, <span class="st">"Ann_Vol"</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html" class="external-link">boxplot</a></span><span class="op">(</span><span class="va">vol_data</span>, col <span class="op">=</span> <span class="va">model_colors</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">available_perf</span><span class="op">)</span><span class="op">]</span>,</span>
<span>          main <span class="op">=</span> <span class="st">"Bootstrap Volatility"</span>,</span>
<span>          ylab <span class="op">=</span> <span class="st">"Annual Volatility (%)"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Add interpretation</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">available_perf</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nThe performance distributions across models show similar ranges,\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"indicating that uncertainty estimates are robust to model choice.\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/performance_uncertainty-1.png" class="r-plt" alt="" width="1152"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## The performance distributions across models show similar ranges,</span></span>
<span><span class="co">## indicating that uncertainty estimates are robust to model choice.</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="part-11-robust-weight-recommendations">Part 11: Robust Weight Recommendations<a class="anchor" aria-label="anchor" href="#part-11-robust-weight-recommendations"></a>
</h2>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<pre><code><span><span class="co">## ROBUST WEIGHT RECOMMENDATIONS</span></span></code></pre>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<div class="sourceCode" id="cb133"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Use compute_robust_estimates() from bootstrap_diagnostics.R if available</span></span>
<span><span class="co">## This provides mean, median, winsorized, and conservative estimates</span></span>
<span><span class="va">compute_robust_weight_estimates</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">boot_w</span>, <span class="va">point_est</span>, <span class="va">symbols</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">is.matrix</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">is.data.frame</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Try package utility first</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/exists.html" class="external-link">exists</a></span><span class="op">(</span><span class="st">"compute_robust_estimates"</span>, mode <span class="op">=</span> <span class="st">"function"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_robust_estimates.html">compute_robust_estimates</a></span><span class="op">(</span><span class="va">boot_w</span>, names <span class="op">=</span> <span class="va">symbols</span>, point_est <span class="op">=</span> <span class="va">point_est</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"Asset"</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">## Fallback implementation</span></span>
<span>  <span class="va">boot_mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">boot_w</span><span class="op">)</span></span>
<span>  <span class="va">boot_median</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">2</span>, <span class="va">median</span><span class="op">)</span></span>
<span>  <span class="va">boot_winsor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span>, trim <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">boot_conservative</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boot_w</span>, <span class="fl">2</span>, <span class="va">quantile</span>, <span class="fl">0.25</span><span class="op">)</span></span>
<span>  <span class="va">boot_conservative</span> <span class="op">&lt;-</span> <span class="va">boot_conservative</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">boot_conservative</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Asset <span class="op">=</span> <span class="va">symbols</span>,</span>
<span>    Point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">point_est</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    Boot_Mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">boot_mean</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    Boot_Median <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">boot_median</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    Winsorized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">boot_winsor</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>    Conservative <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">boot_conservative</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Point estimate from Risk Parity</span></span>
<span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="va">weight_history</span><span class="op">[[</span><span class="st">"Risk Parity"</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">point_est</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">symbols</span></span>
<span></span>
<span><span class="co">## Collect results from available models</span></span>
<span><span class="va">robust_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">dcc_boot</span> <span class="op">&lt;-</span> <span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_dcc</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">dcc_boot</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">robust_results</span><span class="op">[[</span><span class="st">"DCC"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">compute_robust_weight_estimates</span><span class="op">(</span><span class="va">dcc_boot</span>, <span class="va">point_est</span>, <span class="va">symbols</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cgarch_boot</span> <span class="op">&lt;-</span> <span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_cgarch</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">cgarch_boot</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">robust_results</span><span class="op">[[</span><span class="st">"CGARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">compute_robust_weight_estimates</span><span class="op">(</span><span class="va">cgarch_boot</span>, <span class="va">point_est</span>, <span class="va">symbols</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">gogarch_boot</span> <span class="op">&lt;-</span> <span class="fu">safe_get</span><span class="op">(</span><span class="va">boot_results_gogarch</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">gogarch_boot</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">robust_results</span><span class="op">[[</span><span class="st">"GOGARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">compute_robust_weight_estimates</span><span class="op">(</span><span class="va">gogarch_boot</span>, <span class="va">point_est</span>, <span class="va">symbols</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Display results</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">robust_results</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nRobust Weight Estimates from Converged Models:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"(Point = sample estimate, Boot_Mean = bootstrap mean, etc.)\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">model_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">robust_results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- "</span>, <span class="va">model_name</span>, <span class="st">" Model ---\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">robust_results</span><span class="op">[[</span><span class="va">model_name</span><span class="op">]</span><span class="op">]</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">## Cross-model comparison of bootstrap means</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">robust_results</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n--- Cross-Model Comparison (Bootstrap Means) ---\n"</span><span class="op">)</span></span>
<span>    <span class="va">comparison_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Asset <span class="op">=</span> <span class="va">symbols</span>, Point <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">point_est</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">for</span> <span class="op">(</span><span class="va">model_name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">robust_results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">comparison_df</span><span class="op">[[</span><span class="va">model_name</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">robust_results</span><span class="op">[[</span><span class="va">model_name</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">Boot_Mean</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">comparison_df</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nThe bootstrap means across models are generally consistent, suggesting\n"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"the uncertainty estimates are robust to the choice of correlation model.\n"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nNo models converged successfully. Showing point estimates only:\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nRisk Parity Point Estimate:\n"</span><span class="op">)</span></span>
<span>  <span class="va">point_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Asset <span class="op">=</span> <span class="va">symbols</span>, Weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">point_est</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">point_df</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Robust Weight Estimates from Converged Models:</span></span>
<span><span class="co">## (Point = sample estimate, Boot_Mean = bootstrap mean, etc.)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- DCC Model ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Boot_Mean| Boot_Median| Winsorized| Conservative|</span></span>
<span><span class="co">## |:-----|-----:|---------:|-----------:|----------:|------------:|</span></span>
<span><span class="co">## |SPY   | 0.069|     0.071|       0.072|      0.071|        0.066|</span></span>
<span><span class="co">## |EFA   | 0.080|     0.083|       0.086|      0.084|        0.084|</span></span>
<span><span class="co">## |BND   | 0.627|     0.616|       0.622|      0.618|        0.640|</span></span>
<span><span class="co">## |GLD   | 0.153|     0.156|       0.150|      0.151|        0.142|</span></span>
<span><span class="co">## |VNQ   | 0.071|     0.074|       0.071|      0.073|        0.068|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- CGARCH Model ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Boot_Mean| Boot_Median| Winsorized| Conservative|</span></span>
<span><span class="co">## |:-----|-----:|---------:|-----------:|----------:|------------:|</span></span>
<span><span class="co">## |SPY   | 0.069|     0.070|       0.068|      0.069|        0.067|</span></span>
<span><span class="co">## |EFA   | 0.080|     0.080|       0.078|      0.080|        0.077|</span></span>
<span><span class="co">## |BND   | 0.627|     0.620|       0.635|      0.619|        0.628|</span></span>
<span><span class="co">## |GLD   | 0.153|     0.159|       0.155|      0.158|        0.157|</span></span>
<span><span class="co">## |VNQ   | 0.071|     0.070|       0.071|      0.071|        0.070|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- GOGARCH Model ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Boot_Mean| Boot_Median| Winsorized| Conservative|</span></span>
<span><span class="co">## |:-----|-----:|---------:|-----------:|----------:|------------:|</span></span>
<span><span class="co">## |SPY   | 0.069|     0.073|       0.065|      0.069|        0.060|</span></span>
<span><span class="co">## |EFA   | 0.080|     0.085|       0.073|      0.081|        0.072|</span></span>
<span><span class="co">## |BND   | 0.627|     0.587|       0.617|      0.624|        0.650|</span></span>
<span><span class="co">## |GLD   | 0.153|     0.177|       0.160|      0.160|        0.149|</span></span>
<span><span class="co">## |VNQ   | 0.071|     0.079|       0.070|      0.072|        0.069|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- Cross-Model Comparison (Bootstrap Means) ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point|   DCC| CGARCH| GOGARCH|</span></span>
<span><span class="co">## |:-----|-----:|-----:|------:|-------:|</span></span>
<span><span class="co">## |SPY   | 0.069| 0.071|  0.070|   0.073|</span></span>
<span><span class="co">## |EFA   | 0.080| 0.083|  0.080|   0.085|</span></span>
<span><span class="co">## |BND   | 0.627| 0.616|  0.620|   0.587|</span></span>
<span><span class="co">## |GLD   | 0.153| 0.156|  0.159|   0.177|</span></span>
<span><span class="co">## |VNQ   | 0.071| 0.074|  0.070|   0.079|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## The bootstrap means across models are generally consistent, suggesting</span></span>
<span><span class="co">## the uncertainty estimates are robust to the choice of correlation model.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Recommendation Guidelines:</span></span></code></pre>
<pre><code><span><span class="co">##   - For maximum expected return: Use Point Estimate or Boot Mean</span></span></code></pre>
<pre><code><span><span class="co">##   - For robustness: Use Boot Median or Winsorized Mean</span></span></code></pre>
<pre><code><span><span class="co">##   - For risk-averse investors: Use Conservative (25th percentile)</span></span></code></pre>
<pre><code><span><span class="co">##   - Model choice: DCC for interpretability, CGARCH for tail dependence,</span></span></code></pre>
<pre><code><span><span class="co">##                    GOGARCH for factor-based modeling</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="part-12-turnover-and-transaction-cost-analysis">Part 12: Turnover and Transaction Cost Analysis<a class="anchor" aria-label="anchor" href="#part-12-turnover-and-transaction-cost-analysis"></a>
</h2>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## TURNOVER ANALYSIS</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Calculate turnover for each strategy</span></span>
<span><span class="va">turnover_by_strategy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">weight_history</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">strat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">w_hist</span> <span class="op">&lt;-</span> <span class="va">weight_history</span><span class="op">[[</span><span class="va">strat</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">w_hist</span> <span class="op">&lt;-</span> <span class="va">w_hist</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">w_hist</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">w_hist</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">2</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">turnovers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">w_hist</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">w_hist</span><span class="op">[</span><span class="va">t</span>, <span class="op">]</span> <span class="op">-</span> <span class="va">w_hist</span><span class="op">[</span><span class="va">t</span><span class="op">-</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">turnovers</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Average turnover per rebalance (sum of |Δw|):</span></span></code></pre>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">turnover_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">turnover_by_strategy</span><span class="op">)</span>,</span>
<span>  Avg_Turnover <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">turnover_by_strategy</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Turnover_Pct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">turnover_by_strategy</span> <span class="op">*</span> <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">turnover_df</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Strategy        | Avg_Turnover|Turnover_Pct |</span></span>
<span><span class="co">## |:---------------|------------:|:------------|</span></span>
<span><span class="co">## |Equal Weight    |       0.0000|0%           |</span></span>
<span><span class="co">## |Min Variance    |       0.1345|13.5%        |</span></span>
<span><span class="co">## |Max Sharpe      |       0.1345|13.5%        |</span></span>
<span><span class="co">## |Risk Parity     |       0.0854|8.5%         |</span></span>
<span><span class="co">## |Black-Litterman |       0.0000|0%           |</span></span>
<span><span class="co">## |Shrinkage       |       0.0000|0%           |</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Sharpe ratio adjusted for transaction costs (assuming 10bps per turnover):</span></span></code></pre>
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tc_bps</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">rebalances_per_year</span> <span class="op">&lt;-</span> <span class="fl">252</span> <span class="op">/</span> <span class="va">rebalance_freq</span></span>
<span></span>
<span><span class="va">adj_sharpe</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">strategies</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">strat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">raw_sharpe</span> <span class="op">&lt;-</span> <span class="va">perf_summary</span><span class="op">[</span><span class="va">strat</span>, <span class="st">"Sharpe"</span><span class="op">]</span></span>
<span>  <span class="va">turnover</span> <span class="op">&lt;-</span> <span class="va">turnover_by_strategy</span><span class="op">[</span><span class="va">strat</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">turnover</span><span class="op">)</span><span class="op">)</span> <span class="va">turnover</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>  </span>
<span>  <span class="va">tc_drag</span> <span class="op">&lt;-</span> <span class="va">turnover</span> <span class="op">*</span> <span class="op">(</span><span class="va">tc_bps</span> <span class="op">/</span> <span class="fl">10000</span><span class="op">)</span> <span class="op">*</span> <span class="va">rebalances_per_year</span> <span class="op">*</span> <span class="fl">100</span></span>
<span>  <span class="va">adj_return</span> <span class="op">&lt;-</span> <span class="va">perf_summary</span><span class="op">[</span><span class="va">strat</span>, <span class="st">"Ann.Return(%)"</span><span class="op">]</span> <span class="op">-</span> <span class="va">tc_drag</span></span>
<span>  <span class="va">adj_sharpe</span> <span class="op">&lt;-</span> <span class="va">adj_return</span> <span class="op">/</span> <span class="va">perf_summary</span><span class="op">[</span><span class="va">strat</span>, <span class="st">"Ann.Vol(%)"</span><span class="op">]</span></span>
<span>  <span class="va">adj_sharpe</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tc_adj_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">adj_sharpe</span><span class="op">)</span>,</span>
<span>  Raw_Sharpe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">perf_summary</span><span class="op">[</span>, <span class="st">"Sharpe"</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  TC_Adj_Sharpe <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">adj_sharpe</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  Difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">adj_sharpe</span> <span class="op">-</span> <span class="va">perf_summary</span><span class="op">[</span>, <span class="st">"Sharpe"</span><span class="op">]</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">tc_adj_df</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Strategy                        | Raw_Sharpe| TC_Adj_Sharpe| Difference|</span></span>
<span><span class="co">## |:-------------------------------|----------:|-------------:|----------:|</span></span>
<span><span class="co">## |Equal Weight.Equal Weight       |      0.662|         0.662|      0.000|</span></span>
<span><span class="co">## |Min Variance.Min Variance       |      0.558|         0.550|     -0.008|</span></span>
<span><span class="co">## |Max Sharpe.Max Sharpe           |      0.558|         0.550|     -0.008|</span></span>
<span><span class="co">## |Risk Parity.Risk Parity         |      0.612|         0.608|     -0.004|</span></span>
<span><span class="co">## |Black-Litterman.Black-Litterman |      0.662|         0.662|      0.000|</span></span>
<span><span class="co">## |Shrinkage.Shrinkage             |      0.662|         0.662|      0.000|</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="part-13-strategy-comparison-summary">Part 13: Strategy Comparison Summary<a class="anchor" aria-label="anchor" href="#part-13-strategy-comparison-summary"></a>
</h2>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<pre><code><span><span class="co">## STRATEGY COMPARISON SUMMARY</span></span></code></pre>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<div class="sourceCode" id="cb154"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Rank strategies by different metrics</span></span>
<span><span class="va">rankings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Strategy <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">perf_summary</span><span class="op">)</span>,</span>
<span>  Return_Rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="op">-</span><span class="va">perf_summary</span><span class="op">[</span>, <span class="st">"Ann.Return(%)"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  Vol_Rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">perf_summary</span><span class="op">[</span>, <span class="st">"Ann.Vol(%)"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  Sharpe_Rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="op">-</span><span class="va">perf_summary</span><span class="op">[</span>, <span class="st">"Sharpe"</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  MaxDD_Rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="op">-</span><span class="va">perf_summary</span><span class="op">[</span>, <span class="st">"MaxDD(%)"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">rankings</span><span class="op">$</span><span class="va">Avg_Rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">rankings</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">rankings</span> <span class="op">&lt;-</span> <span class="va">rankings</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">rankings</span><span class="op">$</span><span class="va">Avg_Rank</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Strategy rankings (1 = best):</span></span></code></pre>
<div class="sourceCode" id="cb156"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">rankings</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Strategy        | Return_Rank| Vol_Rank| Sharpe_Rank| MaxDD_Rank| Avg_Rank|</span></span>
<span><span class="co">## |:---------------|-----------:|--------:|-----------:|----------:|--------:|</span></span>
<span><span class="co">## |Equal Weight    |         2.0|      5.0|         2.0|        5.0|      3.5|</span></span>
<span><span class="co">## |Min Variance    |         5.5|      1.5|         5.5|        1.5|      3.5|</span></span>
<span><span class="co">## |Max Sharpe      |         5.5|      1.5|         5.5|        1.5|      3.5|</span></span>
<span><span class="co">## |Risk Parity     |         4.0|      3.0|         4.0|        3.0|      3.5|</span></span>
<span><span class="co">## |Black-Litterman |         2.0|      5.0|         2.0|        5.0|      3.5|</span></span>
<span><span class="co">## |Shrinkage       |         2.0|      5.0|         2.0|        5.0|      3.5|</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## KEY FINDINGS</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## 1. PERFORMANCE: Best overall strategy is Equal Weight</span></span></code></pre>
<pre><code><span><span class="co">##    - Highest Sharpe: Equal Weight</span></span></code></pre>
<pre><code><span><span class="co">##    - Lowest volatility: Min Variance</span></span></code></pre>
<pre><code><span><span class="co">##    - Smallest drawdown: Min Variance</span></span></code></pre>
<pre><code><span><span class="co">## 2. MODEL COMPARISON:</span></span></code></pre>
<pre><code><span><span class="co">##    - All three GARCH models (DCC, CGARCH, GOGARCH) capture different</span></span></code></pre>
<pre><code><span><span class="co">##      aspects of the correlation dynamics</span></span></code></pre>
<pre><code><span><span class="co">##    - Bootstrap uncertainty varies by model specification</span></span></code></pre>
<pre><code><span><span class="co">##    - DCC provides explicit correlation parameters (α, β)</span></span></code></pre>
<pre><code><span><span class="co">##    - CGARCH separates marginal and dependence modeling</span></span></code></pre>
<pre><code><span><span class="co">##    - GOGARCH uses factor structure for dimension reduction</span></span></code></pre>
<pre><code><span><span class="co">## 3. UNCERTAINTY: Bootstrap analysis reveals substantial weight uncertainty</span></span></code></pre>
<pre><code><span><span class="co">##    - 95% CIs can span 20-40 percentage points</span></span></code></pre>
<pre><code><span><span class="co">##    - Optimal weights are estimates, not certainties</span></span></code></pre>
<pre><code><span><span class="co">## 4. ROBUSTNESS: Strategies with regularization (Shrinkage, Risk Parity)</span></span></code></pre>
<pre><code><span><span class="co">##    often outperform unconstrained optimization out-of-sample</span></span></code></pre>
<pre><code><span><span class="co">## 5. IMPLICATIONS:</span></span></code></pre>
<pre><code><span><span class="co">##    - Use bootstrap CIs to assess allocation confidence</span></span></code></pre>
<pre><code><span><span class="co">##    - Compare results across model types for robustness</span></span></code></pre>
<pre><code><span><span class="co">##    - Consider robust/regularized methods over naive optimization</span></span></code></pre>
<pre><code><span><span class="co">##    - Report uncertainty alongside point estimates</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="part-14-comparing-bootstrap-methods">Part 14: Comparing Bootstrap Methods<a class="anchor" aria-label="anchor" href="#part-14-comparing-bootstrap-methods"></a>
</h2>
<p>In the previous sections, we compared different multivariate GARCH
specifications (DCC, CGARCH, GOGARCH) within the MS-VARMA-GARCH
bootstrap framework. Now we step back to compare <strong>different
bootstrap methods</strong> themselves.</p>
<div class="section level3">
<h3 id="the-bootstrap-averaging-approach">The Bootstrap Averaging Approach<a class="anchor" aria-label="anchor" href="#the-bootstrap-averaging-approach"></a>
</h3>
<p>In classical portfolio optimization, we compute weights from a single
optimization on the sample covariance matrix. This gives us a point
estimate, but no sense of how uncertain that estimate is.</p>
<p>With bootstrap methods, we can instead:</p>
<ol style="list-style-type: decimal">
<li>Generate many resampled versions of our return series</li>
<li>Compute optimal weights on each resampled series</li>
<li>Average the resulting weights across all bootstrap replicates</li>
</ol>
<p>This <strong>bootstrap-averaged</strong> portfolio has two
advantages:</p>
<ul>
<li>It quantifies uncertainty (via the distribution of weights)</li>
<li>The averaged weights may be more robust than the single-sample
optimum</li>
</ul>
</div>
<div class="section level3">
<h3 id="bootstrap-methods-compared">Bootstrap Methods Compared<a class="anchor" aria-label="anchor" href="#bootstrap-methods-compared"></a>
</h3>
<p>We compare six bootstrap approaches, ranging from simple to
sophisticated:</p>
<table class="table">
<colgroup>
<col width="38%">
<col width="61%">
</colgroup>
<thead><tr class="header">
<th>Method</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Plain (iid)</strong></td>
<td>Resample individual observations (ignores time structure)</td>
</tr>
<tr class="even">
<td><strong>Moving Block</strong></td>
<td>Resample contiguous blocks of 5 days</td>
</tr>
<tr class="odd">
<td><strong>Stationary Block</strong></td>
<td>Random block lengths (geometric distribution)</td>
</tr>
<tr class="even">
<td><strong>HMM</strong></td>
<td>Hidden Markov Model regime-based resampling</td>
</tr>
<tr class="odd">
<td><strong>MS-VARMA-GARCH</strong></td>
<td>Full Markov-Switching GARCH with DCC correlation</td>
</tr>
<tr class="even">
<td><strong>Wild</strong></td>
<td>Multiply returns by random signs (preserves heteroskedasticity)</td>
</tr>
</tbody>
</table>
<p>The simpler methods (Plain, Moving, Stationary) are fast but ignore
complex dependence structures. The model-based methods (HMM,
MS-VARMA-GARCH) capture regime dynamics but require more computation.
Wild bootstrap is designed for heteroskedastic data.</p>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<pre><code><span><span class="co">## BOOTSTRAP METHOD COMPARISON</span></span></code></pre>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<div class="sourceCode" id="cb185"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Use first training window for comparison</span></span>
<span><span class="va">y_compare</span> <span class="op">&lt;-</span> <span class="va">y_full</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">train_window</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co">## Number of bootstrap replicates for comparison</span></span>
<span><span class="va">num_boots_compare</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span></span>
<span><span class="co">## Point estimate (classical single-optimization)</span></span>
<span><span class="va">point_weights</span> <span class="op">&lt;-</span> <span class="fu">risk_parity_portfolio</span><span class="op">(</span><span class="va">y_compare</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb186"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Storage for results</span></span>
<span><span class="va">bootstrap_methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="co">## 1. Plain (iid) Bootstrap - block_length = 1</span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Running Plain (iid) bootstrap...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running Plain (iid) bootstrap...</span></span></code></pre>
<div class="sourceCode" id="cb188"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plain_result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">y_compare</span>,</span>
<span>    bs_type <span class="op">=</span> <span class="st">"moving"</span>,</span>
<span>    num_boots <span class="op">=</span> <span class="va">num_boots_compare</span>,</span>
<span>    block_length <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    func <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>    apply_func_to <span class="op">=</span> <span class="st">"all"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">func_outs</span>, <span class="va">as.vector</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">plain_result</span><span class="op">)</span><span class="op">)</span> <span class="va">bootstrap_methods</span><span class="op">[[</span><span class="st">"Plain (iid)"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">plain_result</span></span>
<span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="co">## 2. Moving Block Bootstrap - block_length = 5</span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Running Moving Block bootstrap...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running Moving Block bootstrap...</span></span></code></pre>
<div class="sourceCode" id="cb190"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moving_result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">y_compare</span>,</span>
<span>    bs_type <span class="op">=</span> <span class="st">"moving"</span>,</span>
<span>    num_boots <span class="op">=</span> <span class="va">num_boots_compare</span>,</span>
<span>    block_length <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    func <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>    apply_func_to <span class="op">=</span> <span class="st">"all"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">func_outs</span>, <span class="va">as.vector</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">moving_result</span><span class="op">)</span><span class="op">)</span> <span class="va">bootstrap_methods</span><span class="op">[[</span><span class="st">"Moving Block"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">moving_result</span></span>
<span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="co">## 3. Stationary Block Bootstrap</span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Running Stationary Block bootstrap...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running Stationary Block bootstrap...</span></span></code></pre>
<div class="sourceCode" id="cb192"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stationary_result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">y_compare</span>,</span>
<span>    bs_type <span class="op">=</span> <span class="st">"stationary"</span>,</span>
<span>    num_boots <span class="op">=</span> <span class="va">num_boots_compare</span>,</span>
<span>    func <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>    apply_func_to <span class="op">=</span> <span class="st">"all"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">func_outs</span>, <span class="va">as.vector</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">stationary_result</span><span class="op">)</span><span class="op">)</span> <span class="va">bootstrap_methods</span><span class="op">[[</span><span class="st">"Stationary"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">stationary_result</span></span>
<span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="co">## 4. HMM Bootstrap</span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Running HMM bootstrap...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running HMM bootstrap...</span></span></code></pre>
<div class="sourceCode" id="cb194"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">y_compare</span>,</span>
<span>    bs_type <span class="op">=</span> <span class="st">"hmm"</span>,</span>
<span>    num_boots <span class="op">=</span> <span class="va">num_boots_compare</span>,</span>
<span>    num_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    func <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>    apply_func_to <span class="op">=</span> <span class="st">"all"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">func_outs</span>, <span class="va">as.vector</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## converged at iteration 34 with logLik: -1084.145</span></span></code></pre>
<div class="sourceCode" id="cb196"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">hmm_result</span><span class="op">)</span><span class="op">)</span> <span class="va">bootstrap_methods</span><span class="op">[[</span><span class="st">"HMM"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">hmm_result</span></span>
<span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="co">## 5. MS-VARMA-GARCH Bootstrap (DCC)</span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Running MS-VARMA-GARCH bootstrap...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running MS-VARMA-GARCH bootstrap...</span></span></code></pre>
<div class="sourceCode" id="cb198"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">msgarch_result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">y_compare</span>,</span>
<span>    bs_type <span class="op">=</span> <span class="st">"ms_varma_garch"</span>,</span>
<span>    num_boots <span class="op">=</span> <span class="va">num_boots_compare</span>,</span>
<span>    num_blocks <span class="op">=</span> <span class="fl">15</span>,</span>
<span>    num_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    spec <span class="op">=</span> <span class="va">spec_dcc</span>,  <span class="co">## Use DCC for stability</span></span>
<span>    model_type <span class="op">=</span> <span class="st">"multivariate"</span>,</span>
<span>    func <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>    apply_func_to <span class="op">=</span> <span class="st">"all"</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_iter <span class="op">=</span> <span class="va">max_iter</span>, tol <span class="op">=</span> <span class="fl">1e-2</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">func_outs</span>, <span class="va">as.vector</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ==========================================================</span></span>
<span><span class="co">## EM Iteration 1... Log-Likelihood: -855.394 (Duration: 00:01:58)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ==========================================================</span></span>
<span><span class="co">## EM Iteration 2... Log-Likelihood: -845.699 (Duration: 00:02:01)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ==========================================================</span></span>
<span><span class="co">## EM Iteration 3... Log-Likelihood: -846.659 (Duration: 00:02:12)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ==========================================================</span></span>
<span><span class="co">## EM Iteration 1... Log-Likelihood: -856.923 (Duration: 00:01:56)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ==========================================================</span></span>
<span><span class="co">## EM Iteration 2... Log-Likelihood: -846.938 (Duration: 00:02:01)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ==========================================================</span></span>
<span><span class="co">## EM Iteration 3...</span></span></code></pre>
<pre><code><span><span class="co">## Log-Likelihood: -847.706 (Duration: 00:02:19)</span></span></code></pre>
<div class="sourceCode" id="cb201"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">msgarch_result</span><span class="op">)</span><span class="op">)</span> <span class="va">bootstrap_methods</span><span class="op">[[</span><span class="st">"MS-VARMA-GARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">msgarch_result</span></span>
<span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="co">## 6. Wild Bootstrap</span></span>
<span><span class="co">## -------------------------------------------------------------------------</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Running Wild bootstrap...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Running Wild bootstrap...</span></span></code></pre>
<div class="sourceCode" id="cb203"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wild_result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">y_compare</span>,</span>
<span>    bs_type <span class="op">=</span> <span class="st">"wild"</span>,</span>
<span>    num_boots <span class="op">=</span> <span class="va">num_boots_compare</span>,</span>
<span>    func <span class="op">=</span> <span class="va">risk_parity_portfolio</span>,</span>
<span>    apply_func_to <span class="op">=</span> <span class="st">"all"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">result</span><span class="op">$</span><span class="va">func_outs</span>, <span class="va">as.vector</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"  Failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">wild_result</span><span class="op">)</span><span class="op">)</span> <span class="va">bootstrap_methods</span><span class="op">[[</span><span class="st">"Wild"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">wild_result</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nCompleted"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bootstrap_methods</span><span class="op">)</span>, <span class="st">"of 6 bootstrap methods.\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Completed 6 of 6 bootstrap methods.</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## BOOTSTRAP-AVERAGED WEIGHTS COMPARISON</span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Point estimate vs. bootstrap-averaged weights by method:</span></span>
<span><span class="co">## (Point = single optimization, Boot_Mean = average of 30 optimizations)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- Plain (iid) ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Boot_Mean| Boot_SD| CI_Width|</span></span>
<span><span class="co">## |:-----|-----:|---------:|-------:|--------:|</span></span>
<span><span class="co">## |SPY   | 0.069|      0.07|   0.006|    0.022|</span></span>
<span><span class="co">## |EFA   | 0.080|      0.08|   0.006|    0.023|</span></span>
<span><span class="co">## |BND   | 0.627|      0.63|   0.020|    0.066|</span></span>
<span><span class="co">## |GLD   | 0.153|      0.15|   0.013|    0.044|</span></span>
<span><span class="co">## |VNQ   | 0.071|      0.07|   0.005|    0.017|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- Moving Block ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Boot_Mean| Boot_SD| CI_Width|</span></span>
<span><span class="co">## |:-----|-----:|---------:|-------:|--------:|</span></span>
<span><span class="co">## |SPY   | 0.069|     0.068|   0.007|    0.026|</span></span>
<span><span class="co">## |EFA   | 0.080|     0.079|   0.007|    0.023|</span></span>
<span><span class="co">## |BND   | 0.627|     0.634|   0.021|    0.072|</span></span>
<span><span class="co">## |GLD   | 0.153|     0.149|   0.011|    0.036|</span></span>
<span><span class="co">## |VNQ   | 0.071|     0.070|   0.005|    0.019|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- Stationary ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Boot_Mean| Boot_SD| CI_Width|</span></span>
<span><span class="co">## |:-----|-----:|---------:|-------:|--------:|</span></span>
<span><span class="co">## |SPY   | 0.069|     0.071|   0.008|    0.025|</span></span>
<span><span class="co">## |EFA   | 0.080|     0.082|   0.008|    0.030|</span></span>
<span><span class="co">## |BND   | 0.627|     0.622|   0.024|    0.082|</span></span>
<span><span class="co">## |GLD   | 0.153|     0.153|   0.010|    0.033|</span></span>
<span><span class="co">## |VNQ   | 0.071|     0.071|   0.006|    0.017|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- HMM ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Boot_Mean| Boot_SD| CI_Width|</span></span>
<span><span class="co">## |:-----|-----:|---------:|-------:|--------:|</span></span>
<span><span class="co">## |SPY   | 0.069|     0.069|   0.007|    0.025|</span></span>
<span><span class="co">## |EFA   | 0.080|     0.081|   0.006|    0.021|</span></span>
<span><span class="co">## |BND   | 0.627|     0.627|   0.016|    0.056|</span></span>
<span><span class="co">## |GLD   | 0.153|     0.152|   0.011|    0.037|</span></span>
<span><span class="co">## |VNQ   | 0.071|     0.070|   0.005|    0.018|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- MS-VARMA-GARCH ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Boot_Mean| Boot_SD| CI_Width|</span></span>
<span><span class="co">## |:-----|-----:|---------:|-------:|--------:|</span></span>
<span><span class="co">## |SPY   | 0.069|     0.070|   0.022|    0.080|</span></span>
<span><span class="co">## |EFA   | 0.080|     0.083|   0.027|    0.087|</span></span>
<span><span class="co">## |BND   | 0.627|     0.611|   0.128|    0.346|</span></span>
<span><span class="co">## |GLD   | 0.153|     0.163|   0.069|    0.171|</span></span>
<span><span class="co">## |VNQ   | 0.071|     0.074|   0.029|    0.083|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## --- Wild ---</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Boot_Mean| Boot_SD| CI_Width|</span></span>
<span><span class="co">## |:-----|-----:|---------:|-------:|--------:|</span></span>
<span><span class="co">## |SPY   | 0.069|     0.069|   0.000|    0.001|</span></span>
<span><span class="co">## |EFA   | 0.080|     0.080|   0.000|    0.001|</span></span>
<span><span class="co">## |BND   | 0.627|     0.627|   0.001|    0.003|</span></span>
<span><span class="co">## |GLD   | 0.153|     0.153|   0.001|    0.002|</span></span>
<span><span class="co">## |VNQ   | 0.071|     0.071|   0.000|    0.001|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## CROSS-METHOD COMPARISON (Bootstrap Mean Weights)</span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Asset | Point| Plain (iid)| Moving Block| Stationary|   HMM| MS-VARMA-GARCH|  Wild|</span></span>
<span><span class="co">## |:-----|-----:|-----------:|------------:|----------:|-----:|--------------:|-----:|</span></span>
<span><span class="co">## |SPY   | 0.069|        0.07|        0.068|      0.071| 0.069|          0.070| 0.069|</span></span>
<span><span class="co">## |EFA   | 0.080|        0.08|        0.079|      0.082| 0.081|          0.083| 0.080|</span></span>
<span><span class="co">## |BND   | 0.627|        0.63|        0.634|      0.622| 0.627|          0.611| 0.627|</span></span>
<span><span class="co">## |GLD   | 0.153|        0.15|        0.149|      0.153| 0.152|          0.163| 0.153|</span></span>
<span><span class="co">## |VNQ   | 0.071|        0.07|        0.070|      0.071| 0.070|          0.074| 0.071|</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## UNCERTAINTY BY METHOD (Mean 95% CI Width)</span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## |Method         | Mean_CI_Width|</span></span>
<span><span class="co">## |:--------------|-------------:|</span></span>
<span><span class="co">## |Wild           |        0.0014|</span></span>
<span><span class="co">## |HMM            |        0.0313|</span></span>
<span><span class="co">## |Plain (iid)    |        0.0345|</span></span>
<span><span class="co">## |Moving Block   |        0.0351|</span></span>
<span><span class="co">## |Stationary     |        0.0375|</span></span>
<span><span class="co">## |MS-VARMA-GARCH |        0.1535|</span></span></code></pre>
<div class="sourceCode" id="cb206"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Visualization: Weight distributions across all bootstrap methods</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">bootstrap_methods</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">## Prepare data for plotting</span></span>
<span>  <span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bootstrap_methods</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">method</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">boot_mat</span> <span class="op">&lt;-</span> <span class="va">bootstrap_methods</span><span class="op">[[</span><span class="va">method</span><span class="op">]</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>      Weight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">boot_mat</span><span class="op">)</span>,</span>
<span>      Asset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">symbols</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_mat</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      Method <span class="op">=</span> <span class="va">method</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">plot_list</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Set method order (simple to complex)</span></span>
<span>  <span class="va">method_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Plain (iid)"</span>, <span class="st">"Moving Block"</span>, <span class="st">"Stationary"</span>, <span class="st">"Wild"</span>, <span class="st">"HMM"</span>, <span class="st">"MS-VARMA-GARCH"</span><span class="op">)</span></span>
<span>  <span class="va">method_order</span> <span class="op">&lt;-</span> <span class="va">method_order</span><span class="op">[</span><span class="va">method_order</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bootstrap_methods</span><span class="op">)</span><span class="op">]</span></span>
<span>  <span class="va">plot_df</span><span class="op">$</span><span class="va">Method</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plot_df</span><span class="op">$</span><span class="va">Method</span>, levels <span class="op">=</span> <span class="va">method_order</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Add point estimate reference</span></span>
<span>  <span class="va">point_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Asset <span class="op">=</span> <span class="va">symbols</span>,</span>
<span>    Point <span class="op">=</span> <span class="va">point_weights</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Create plot</span></span>
<span>  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Method</span>, y <span class="op">=</span> <span class="va">Weight</span>, fill <span class="op">=</span> <span class="va">Method</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.7</span>, outlier.size <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">point_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">Point</span><span class="op">)</span>, </span>
<span>               linetype <span class="op">=</span> <span class="st">"dashed"</span>, color <span class="op">=</span> <span class="st">"red"</span>, linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Asset</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"Portfolio Weight Distributions by Bootstrap Method"</span>,</span>
<span>      subtitle <span class="op">=</span> <span class="st">"Red dashed line = point estimate (single optimization). Boxes = distribution across bootstrap replicates."</span>,</span>
<span>      x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>      y <span class="op">=</span> <span class="st">"Weight"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      legend.position <span class="op">=</span> <span class="st">"none"</span>,</span>
<span>      axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,</span>
<span>      strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>      plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/bootstrap_comparison_plot-1.png" class="r-plt" alt="" width="1152"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## INTERPRETATION</span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Key observations:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1. POINT vs BOOTSTRAP MEAN: The bootstrap-averaged weights generally differ</span></span>
<span><span class="co">##    from the point estimate, sometimes substantially. This reflects estimation</span></span>
<span><span class="co">##    uncertainty that the single-sample optimum ignores.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 2. METHOD AGREEMENT: If different bootstrap methods produce similar averaged</span></span>
<span><span class="co">##    weights, this suggests the result is robust. Large disagreements indicate</span></span>
<span><span class="co">##    sensitivity to assumptions about the data-generating process.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 3. UNCERTAINTY LEVELS: Simpler methods (Plain, Moving) often show different</span></span>
<span><span class="co">##    uncertainty than model-based methods (HMM, MS-VARMA-GARCH). Neither is</span></span>
<span><span class="co">##    'correct' - they reflect different assumptions about dependence structure.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 4. PRACTICAL GUIDANCE:</span></span>
<span><span class="co">##    - For quick robustness checks: use Moving or Stationary block bootstrap</span></span>
<span><span class="co">##    - For regime-aware analysis: use HMM or MS-VARMA-GARCH</span></span>
<span><span class="co">##    - For heteroskedasticity: Wild bootstrap preserves variance patterns</span></span>
<span><span class="co">##    - Report results from multiple methods when possible</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="runtime-benchmark">Runtime Benchmark<a class="anchor" aria-label="anchor" href="#runtime-benchmark"></a>
</h3>
<p>Different bootstrap methods have vastly different computational
costs. The simpler block-based methods are fast, while model-based
methods (HMM, MS-VARMA-GARCH) require fitting complex models and are
correspondingly slower.</p>
<p>The <code><a href="../reference/benchmark_tsbs.html">benchmark_tsbs()</a></code> utility allows systematic
comparison of runtime across methods as we vary parameters like the
number of bootstrap replicates. This helps in choosing an appropriate
method given time constraints.</p>
<p>Note that the MS VARMA GARCH Bootstrap is very much slower than any
of the other bootstrap methods.</p>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## RUNTIME BENCHMARK</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define setups to benchmark (excluding slow MS-VARMA-GARCH for quick demo)</span></span>
<span><span class="va">benchmark_setups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Plain (iid)"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"moving"</span>, block_length <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"Moving Block"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"moving"</span>, block_length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"Stationary"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"stationary"</span><span class="op">)</span>,</span>
<span>  <span class="st">"HMM"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"hmm"</span>, num_states <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="st">"Wild"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"wild"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add HMM only for full analysis (it's moderately slow)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">FULL_ANALYSIS</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## Note: We don't pass 'func' - we're measuring bootstrap generation time only</span></span>
<span>  <span class="va">benchmark_setups</span><span class="op">[[</span><span class="st">"MSGARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    bs_type <span class="op">=</span> <span class="st">"ms_varma_garch"</span>, </span>
<span>    model_type <span class="op">=</span> <span class="st">"multivariate"</span>,</span>
<span>    num_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    spec <span class="op">=</span> <span class="va">spec_dcc</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_iter <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Values to test: number of bootstrap replicates</span></span>
<span><span class="co">#benchmark_values &lt;- c(10, 25, 50)</span></span>
<span><span class="va">benchmark_values</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">FULL_ANALYSIS</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">benchmark_values</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Benchmarking"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">benchmark_setups</span><span class="op">)</span>, <span class="st">"methods across"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">benchmark_values</span><span class="op">)</span>, <span class="st">"replicate counts...\n\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Benchmarking 5 methods across 7 replicate counts...</span></span></code></pre>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run benchmark</span></span>
<span><span class="va">bench_result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/benchmark_tsbs.html">benchmark_tsbs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">y_compare</span>,</span>
<span>    setups <span class="op">=</span> <span class="va">benchmark_setups</span>,</span>
<span>    vary <span class="op">=</span> <span class="st">"num_boots"</span>,</span>
<span>    values <span class="op">=</span> <span class="va">benchmark_values</span>,</span>
<span>    times <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Benchmark failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1/105] Plain (iid): num_boots = 8 (rep 1/3)    [2/105] Plain (iid): num_boots = 8 (rep 2/3)    [3/105] Plain (iid): num_boots = 8 (rep 3/3)    [4/105] Plain (iid): num_boots = 16 (rep 1/3)    [5/105] Plain (iid): num_boots = 16 (rep 2/3)    [6/105] Plain (iid): num_boots = 16 (rep 3/3)    [7/105] Plain (iid): num_boots = 32 (rep 1/3)    [8/105] Plain (iid): num_boots = 32 (rep 2/3)    [9/105] Plain (iid): num_boots = 32 (rep 3/3)    [10/105] Plain (iid): num_boots = 64 (rep 1/3)    [11/105] Plain (iid): num_boots = 64 (rep 2/3)    [12/105] Plain (iid): num_boots = 64 (rep 3/3)    [13/105] Plain (iid): num_boots = 128 (rep 1/3)    [14/105] Plain (iid): num_boots = 128 (rep 2/3)    [15/105] Plain (iid): num_boots = 128 (rep 3/3)    [16/105] Plain (iid): num_boots = 256 (rep 1/3)    [17/105] Plain (iid): num_boots = 256 (rep 2/3)    [18/105] Plain (iid): num_boots = 256 (rep 3/3)    [19/105] Plain (iid): num_boots = 512 (rep 1/3)    [20/105] Plain (iid): num_boots = 512 (rep 2/3)    [21/105] Plain (iid): num_boots = 512 (rep 3/3)    [22/105] Moving Block: num_boots = 8 (rep 1/3)    [23/105] Moving Block: num_boots = 8 (rep 2/3)    [24/105] Moving Block: num_boots = 8 (rep 3/3)    [25/105] Moving Block: num_boots = 16 (rep 1/3)    [26/105] Moving Block: num_boots = 16 (rep 2/3)    [27/105] Moving Block: num_boots = 16 (rep 3/3)    [28/105] Moving Block: num_boots = 32 (rep 1/3)    [29/105] Moving Block: num_boots = 32 (rep 2/3)    [30/105] Moving Block: num_boots = 32 (rep 3/3)    [31/105] Moving Block: num_boots = 64 (rep 1/3)    [32/105] Moving Block: num_boots = 64 (rep 2/3)    [33/105] Moving Block: num_boots = 64 (rep 3/3)    [34/105] Moving Block: num_boots = 128 (rep 1/3)    [35/105] Moving Block: num_boots = 128 (rep 2/3)    [36/105] Moving Block: num_boots = 128 (rep 3/3)    [37/105] Moving Block: num_boots = 256 (rep 1/3)    [38/105] Moving Block: num_boots = 256 (rep 2/3)    [39/105] Moving Block: num_boots = 256 (rep 3/3)    [40/105] Moving Block: num_boots = 512 (rep 1/3)    [41/105] Moving Block: num_boots = 512 (rep 2/3)    [42/105] Moving Block: num_boots = 512 (rep 3/3)    [43/105] Stationary: num_boots = 8 (rep 1/3)    [44/105] Stationary: num_boots = 8 (rep 2/3)    [45/105] Stationary: num_boots = 8 (rep 3/3)    [46/105] Stationary: num_boots = 16 (rep 1/3)    [47/105] Stationary: num_boots = 16 (rep 2/3)    [48/105] Stationary: num_boots = 16 (rep 3/3)    [49/105] Stationary: num_boots = 32 (rep 1/3)    [50/105] Stationary: num_boots = 32 (rep 2/3)    [51/105] Stationary: num_boots = 32 (rep 3/3)    [52/105] Stationary: num_boots = 64 (rep 1/3)    [53/105] Stationary: num_boots = 64 (rep 2/3)    [54/105] Stationary: num_boots = 64 (rep 3/3)    [55/105] Stationary: num_boots = 128 (rep 1/3)    [56/105] Stationary: num_boots = 128 (rep 2/3)    [57/105] Stationary: num_boots = 128 (rep 3/3)    [58/105] Stationary: num_boots = 256 (rep 1/3)    [59/105] Stationary: num_boots = 256 (rep 2/3)    [60/105] Stationary: num_boots = 256 (rep 3/3)    [61/105] Stationary: num_boots = 512 (rep 1/3)    [62/105] Stationary: num_boots = 512 (rep 2/3)    [63/105] Stationary: num_boots = 512 (rep 3/3)    [64/105] HMM: num_boots = 8 (rep 1/3)    converged at iteration 32 with logLik: -1084.145 </span></span>
<span><span class="co">## [65/105] HMM: num_boots = 8 (rep 2/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [66/105] HMM: num_boots = 8 (rep 3/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [67/105] HMM: num_boots = 16 (rep 1/3)    converged at iteration 36 with logLik: -1084.145 </span></span>
<span><span class="co">## [68/105] HMM: num_boots = 16 (rep 2/3)    converged at iteration 35 with logLik: -1084.145 </span></span>
<span><span class="co">## [69/105] HMM: num_boots = 16 (rep 3/3)    converged at iteration 35 with logLik: -1084.145 </span></span>
<span><span class="co">## [70/105] HMM: num_boots = 32 (rep 1/3)    converged at iteration 35 with logLik: -1084.145 </span></span>
<span><span class="co">## [71/105] HMM: num_boots = 32 (rep 2/3)    converged at iteration 36 with logLik: -1084.145 </span></span>
<span><span class="co">## [72/105] HMM: num_boots = 32 (rep 3/3)    converged at iteration 34 with logLik: -1084.145 </span></span>
<span><span class="co">## [73/105] HMM: num_boots = 64 (rep 1/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [74/105] HMM: num_boots = 64 (rep 2/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [75/105] HMM: num_boots = 64 (rep 3/3)    converged at iteration 32 with logLik: -1084.145 </span></span>
<span><span class="co">## [76/105] HMM: num_boots = 128 (rep 1/3)    converged at iteration 35 with logLik: -1084.145 </span></span>
<span><span class="co">## [77/105] HMM: num_boots = 128 (rep 2/3)    converged at iteration 23 with logLik: -1084.145 </span></span>
<span><span class="co">## [78/105] HMM: num_boots = 128 (rep 3/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [79/105] HMM: num_boots = 256 (rep 1/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [80/105] HMM: num_boots = 256 (rep 2/3)    converged at iteration 34 with logLik: -1084.145 </span></span>
<span><span class="co">## [81/105] HMM: num_boots = 256 (rep 3/3)    converged at iteration 28 with logLik: -1084.145 </span></span>
<span><span class="co">## [82/105] HMM: num_boots = 512 (rep 1/3)    converged at iteration 32 with logLik: -1084.145 </span></span>
<span><span class="co">## [83/105] HMM: num_boots = 512 (rep 2/3)    converged at iteration 29 with logLik: -1084.145 </span></span>
<span><span class="co">## [84/105] HMM: num_boots = 512 (rep 3/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [85/105] Wild: num_boots = 8 (rep 1/3)    [86/105] Wild: num_boots = 8 (rep 2/3)    [87/105] Wild: num_boots = 8 (rep 3/3)    [88/105] Wild: num_boots = 16 (rep 1/3)    [89/105] Wild: num_boots = 16 (rep 2/3)    [90/105] Wild: num_boots = 16 (rep 3/3)    [91/105] Wild: num_boots = 32 (rep 1/3)    [92/105] Wild: num_boots = 32 (rep 2/3)    [93/105] Wild: num_boots = 32 (rep 3/3)    [94/105] Wild: num_boots = 64 (rep 1/3)    [95/105] Wild: num_boots = 64 (rep 2/3)    [96/105] Wild: num_boots = 64 (rep 3/3)    [97/105] Wild: num_boots = 128 (rep 1/3)    [98/105] Wild: num_boots = 128 (rep 2/3)    [99/105] Wild: num_boots = 128 (rep 3/3)    [100/105] Wild: num_boots = 256 (rep 1/3)    [101/105] Wild: num_boots = 256 (rep 2/3)    [102/105] Wild: num_boots = 256 (rep 3/3)    [103/105] Wild: num_boots = 512 (rep 1/3)    [104/105] Wild: num_boots = 512 (rep 2/3)    [105/105] Wild: num_boots = 512 (rep 3/3)</span></span></code></pre>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Display results</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">bench_result</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bench_result</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Plot</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bench_result</span>, show_ribbon <span class="op">=</span> <span class="cn">FALSE</span>, show_points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## tsbs Benchmark Results</span></span>
<span><span class="co">## ======================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Varying parameter: num_boots </span></span>
<span><span class="co">## Values tested: 8, 16, 32, 64, 128, 256, 512 </span></span>
<span><span class="co">## Repetitions per test: 3 </span></span>
<span><span class="co">## Input data dimensions: 252 x 5 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Setups compared:</span></span>
<span><span class="co">##   - Plain (iid) : bs_type = moving, block_length = 1</span></span>
<span><span class="co">##   - Moving Block : bs_type = moving, block_length = 5</span></span>
<span><span class="co">##   - Stationary : bs_type = stationary</span></span>
<span><span class="co">##   - HMM : bs_type = hmm</span></span>
<span><span class="co">##   - Wild : bs_type = wild</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Mean runtime (seconds) by setup and num_boots :</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Value   HMM Moving Block Plain (iid) Stationary    Wild</span></span>
<span><span class="co">##      8 0.148      0.00104    0.000882   0.000809 0.00361</span></span>
<span><span class="co">##     16 0.133      0.00140    0.001412   0.001222 0.00505</span></span>
<span><span class="co">##     32 0.141      0.08305    0.002383   0.003679 0.00790</span></span>
<span><span class="co">##     64 0.152      0.00372    0.004312   0.003910 0.01359</span></span>
<span><span class="co">##    128 0.195      0.00696    0.007568   0.012244 0.02817</span></span>
<span><span class="co">##    256 0.286      0.01527    0.021098   0.016304 0.05157</span></span>
<span><span class="co">##    512 0.479      0.03045    0.044552   0.032129 0.17237</span></span></code></pre>
<p><img src="portfolio-optimization-demo_files/figure-html/benchmark_run-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define setups to benchmark (excluding slow MS-VARMA-GARCH for quick demo)</span></span>
<span><span class="va">benchmark_setups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Plain (iid)"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"moving"</span>, block_length <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"Moving Block"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"moving"</span>, block_length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"Stationary"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"stationary"</span><span class="op">)</span>,</span>
<span>  <span class="st">"HMM"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"hmm"</span>, num_states <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="st">"Wild"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"wild"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add HMM only for full analysis (it's moderately slow)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">FULL_ANALYSIS</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## Note: We don't pass 'func' - we're measuring bootstrap generation time only</span></span>
<span>  <span class="va">benchmark_setups</span><span class="op">[[</span><span class="st">"MSGARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    bs_type <span class="op">=</span> <span class="st">"ms_varma_garch"</span>, </span>
<span>    model_type <span class="op">=</span> <span class="st">"multivariate"</span>,</span>
<span>    num_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    spec <span class="op">=</span> <span class="va">spec_dcc</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_iter <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Values to test: number of bootstrap replicates</span></span>
<span><span class="co">#benchmark_values &lt;- c(10, 25, 50)</span></span>
<span><span class="va">benchmark_values</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">FULL_ANALYSIS</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">benchmark_values</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">6</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Benchmarking"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">benchmark_setups</span><span class="op">)</span>, <span class="st">"methods across"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">benchmark_values</span><span class="op">)</span>, <span class="st">"replicate counts...\n\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Benchmarking 5 methods across 5 replicate counts...</span></span></code></pre>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run benchmark</span></span>
<span><span class="va">bench_result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/benchmark_tsbs.html">benchmark_tsbs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">y_compare</span>,</span>
<span>    setups <span class="op">=</span> <span class="va">benchmark_setups</span>,</span>
<span>    vary <span class="op">=</span> <span class="st">"n_boot"</span>,</span>
<span>    values <span class="op">=</span> <span class="va">benchmark_values</span>,</span>
<span>    times <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Benchmark failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1/75] Plain (iid): n_boot = 64 (rep 1/3)    [2/75] Plain (iid): n_boot = 64 (rep 2/3)    [3/75] Plain (iid): n_boot = 64 (rep 3/3)    [4/75] Plain (iid): n_boot = 128 (rep 1/3)    [5/75] Plain (iid): n_boot = 128 (rep 2/3)    [6/75] Plain (iid): n_boot = 128 (rep 3/3)    [7/75] Plain (iid): n_boot = 256 (rep 1/3)    [8/75] Plain (iid): n_boot = 256 (rep 2/3)    [9/75] Plain (iid): n_boot = 256 (rep 3/3)    [10/75] Plain (iid): n_boot = 512 (rep 1/3)    [11/75] Plain (iid): n_boot = 512 (rep 2/3)    [12/75] Plain (iid): n_boot = 512 (rep 3/3)    [13/75] Plain (iid): n_boot = 1024 (rep 1/3)    [14/75] Plain (iid): n_boot = 1024 (rep 2/3)    [15/75] Plain (iid): n_boot = 1024 (rep 3/3)    [16/75] Moving Block: n_boot = 64 (rep 1/3)    [17/75] Moving Block: n_boot = 64 (rep 2/3)    [18/75] Moving Block: n_boot = 64 (rep 3/3)    [19/75] Moving Block: n_boot = 128 (rep 1/3)    [20/75] Moving Block: n_boot = 128 (rep 2/3)    [21/75] Moving Block: n_boot = 128 (rep 3/3)    [22/75] Moving Block: n_boot = 256 (rep 1/3)    [23/75] Moving Block: n_boot = 256 (rep 2/3)    [24/75] Moving Block: n_boot = 256 (rep 3/3)    [25/75] Moving Block: n_boot = 512 (rep 1/3)    [26/75] Moving Block: n_boot = 512 (rep 2/3)    [27/75] Moving Block: n_boot = 512 (rep 3/3)    [28/75] Moving Block: n_boot = 1024 (rep 1/3)    [29/75] Moving Block: n_boot = 1024 (rep 2/3)    [30/75] Moving Block: n_boot = 1024 (rep 3/3)    [31/75] Stationary: n_boot = 64 (rep 1/3)    [32/75] Stationary: n_boot = 64 (rep 2/3)    [33/75] Stationary: n_boot = 64 (rep 3/3)    [34/75] Stationary: n_boot = 128 (rep 1/3)    [35/75] Stationary: n_boot = 128 (rep 2/3)    [36/75] Stationary: n_boot = 128 (rep 3/3)    [37/75] Stationary: n_boot = 256 (rep 1/3)    [38/75] Stationary: n_boot = 256 (rep 2/3)    [39/75] Stationary: n_boot = 256 (rep 3/3)    [40/75] Stationary: n_boot = 512 (rep 1/3)    [41/75] Stationary: n_boot = 512 (rep 2/3)    [42/75] Stationary: n_boot = 512 (rep 3/3)    [43/75] Stationary: n_boot = 1024 (rep 1/3)    [44/75] Stationary: n_boot = 1024 (rep 2/3)    [45/75] Stationary: n_boot = 1024 (rep 3/3)    [46/75] HMM: n_boot = 64 (rep 1/3)    converged at iteration 34 with logLik: -1084.145 </span></span>
<span><span class="co">## [47/75] HMM: n_boot = 64 (rep 2/3)    converged at iteration 29 with logLik: -1084.145 </span></span>
<span><span class="co">## [48/75] HMM: n_boot = 64 (rep 3/3)    converged at iteration 34 with logLik: -1084.145 </span></span>
<span><span class="co">## [49/75] HMM: n_boot = 128 (rep 1/3)    converged at iteration 35 with logLik: -1084.145 </span></span>
<span><span class="co">## [50/75] HMM: n_boot = 128 (rep 2/3)    converged at iteration 35 with logLik: -1084.145 </span></span>
<span><span class="co">## [51/75] HMM: n_boot = 128 (rep 3/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [52/75] HMM: n_boot = 256 (rep 1/3)    converged at iteration 32 with logLik: -1084.145 </span></span>
<span><span class="co">## [53/75] HMM: n_boot = 256 (rep 2/3)    converged at iteration 36 with logLik: -1084.145 </span></span>
<span><span class="co">## [54/75] HMM: n_boot = 256 (rep 3/3)    converged at iteration 35 with logLik: -1084.145 </span></span>
<span><span class="co">## [55/75] HMM: n_boot = 512 (rep 1/3)    converged at iteration 34 with logLik: -1084.145 </span></span>
<span><span class="co">## [56/75] HMM: n_boot = 512 (rep 2/3)    converged at iteration 34 with logLik: -1084.145 </span></span>
<span><span class="co">## [57/75] HMM: n_boot = 512 (rep 3/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [58/75] HMM: n_boot = 1024 (rep 1/3)    converged at iteration 33 with logLik: -1084.145 </span></span>
<span><span class="co">## [59/75] HMM: n_boot = 1024 (rep 2/3)    converged at iteration 26 with logLik: -1084.145 </span></span>
<span><span class="co">## [60/75] HMM: n_boot = 1024 (rep 3/3)    converged at iteration 34 with logLik: -1084.145 </span></span>
<span><span class="co">## [61/75] Wild: n_boot = 64 (rep 1/3)    [62/75] Wild: n_boot = 64 (rep 2/3)    [63/75] Wild: n_boot = 64 (rep 3/3)    [64/75] Wild: n_boot = 128 (rep 1/3)    [65/75] Wild: n_boot = 128 (rep 2/3)    [66/75] Wild: n_boot = 128 (rep 3/3)    [67/75] Wild: n_boot = 256 (rep 1/3)    [68/75] Wild: n_boot = 256 (rep 2/3)    [69/75] Wild: n_boot = 256 (rep 3/3)    [70/75] Wild: n_boot = 512 (rep 1/3)    [71/75] Wild: n_boot = 512 (rep 2/3)    [72/75] Wild: n_boot = 512 (rep 3/3)    [73/75] Wild: n_boot = 1024 (rep 1/3)    [74/75] Wild: n_boot = 1024 (rep 2/3)    [75/75] Wild: n_boot = 1024 (rep 3/3)</span></span></code></pre>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Display results</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">bench_result</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bench_result</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Plot</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bench_result</span>, show_ribbon <span class="op">=</span> <span class="cn">FALSE</span>, show_points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## tsbs Benchmark Results</span></span>
<span><span class="co">## ======================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Varying parameter: n_boot </span></span>
<span><span class="co">## Values tested: 64, 128, 256, 512, 1024 </span></span>
<span><span class="co">## Repetitions per test: 3 </span></span>
<span><span class="co">## Input data dimensions: 252 x 5 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Setups compared:</span></span>
<span><span class="co">##   - Plain (iid) : bs_type = moving, block_length = 1</span></span>
<span><span class="co">##   - Moving Block : bs_type = moving, block_length = 5</span></span>
<span><span class="co">##   - Stationary : bs_type = stationary</span></span>
<span><span class="co">##   - HMM : bs_type = hmm</span></span>
<span><span class="co">##   - Wild : bs_type = wild</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Mean runtime (seconds) by setup and n_boot :</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Value   HMM Moving Block Plain (iid) Stationary   Wild</span></span>
<span><span class="co">##     64 0.129      0.00453     0.00480    0.00468 0.0205</span></span>
<span><span class="co">##    128 0.147      0.00497     0.00514    0.00508 0.0227</span></span>
<span><span class="co">##    256 0.184      0.00570     0.00597    0.00759 0.0203</span></span>
<span><span class="co">##    512 0.258      0.00906     0.00972    0.01390 0.0204</span></span>
<span><span class="co">##   1024 0.463      0.01322     0.01238    0.01309 0.0232</span></span></code></pre>
<p><img src="portfolio-optimization-demo_files/figure-html/benchmark_run_nboot-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Define setups to benchmark (excluding slow MS-VARMA-GARCH for quick demo)</span></span>
<span><span class="va">benchmark_setups</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Plain (iid)"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"moving"</span>, block_length <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>  <span class="st">"Moving Block"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"moving"</span>, block_length <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="st">"Stationary"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"stationary"</span><span class="op">)</span>,</span>
<span>  <span class="st">"HMM"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"hmm"</span>, num_states <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  <span class="st">"Wild"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bs_type <span class="op">=</span> <span class="st">"wild"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add HMM only for full analysis (it's moderately slow)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">FULL_ANALYSIS</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co">## Note: We don't pass 'func' - we're measuring bootstrap generation time only</span></span>
<span>  <span class="va">benchmark_setups</span><span class="op">[[</span><span class="st">"MSGARCH"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    bs_type <span class="op">=</span> <span class="st">"ms_varma_garch"</span>, </span>
<span>    model_type <span class="op">=</span> <span class="st">"multivariate"</span>,</span>
<span>    num_states <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    spec <span class="op">=</span> <span class="va">spec_dcc</span>,</span>
<span>    control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>max_iter <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Values to test: number of bootstrap replicates</span></span>
<span><span class="co">#benchmark_values &lt;- c(10, 25, 50)</span></span>
<span><span class="va">benchmark_values</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">FULL_ANALYSIS</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">benchmark_values</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">^</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Benchmarking"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">benchmark_setups</span><span class="op">)</span>, <span class="st">"methods across"</span>, </span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">benchmark_values</span><span class="op">)</span>, <span class="st">"replicate counts...\n\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Benchmarking 5 methods across 6 replicate counts...</span></span></code></pre>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run benchmark</span></span>
<span><span class="va">bench_result</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/benchmark_tsbs.html">benchmark_tsbs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="op">(</span><span class="fl">2</span><span class="op">^</span><span class="fl">7</span><span class="op">)</span> <span class="op">*</span> <span class="fl">252</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">252</span><span class="op">)</span>,<span class="co">#y_compare,</span></span>
<span>    setups <span class="op">=</span> <span class="va">benchmark_setups</span>,</span>
<span>    vary <span class="op">=</span> <span class="st">"n_assets"</span>,</span>
<span>    values <span class="op">=</span> <span class="va">benchmark_values</span>,</span>
<span>    times <span class="op">=</span> <span class="fl">3</span>,</span>
<span>    verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="st">"Benchmark failed: "</span>, <span class="va">e</span><span class="op">$</span><span class="va">message</span><span class="op">)</span></span>
<span>  <span class="cn">NULL</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1/90] Plain (iid): n_assets = 4 (rep 1/3)    [2/90] Plain (iid): n_assets = 4 (rep 2/3)    [3/90] Plain (iid): n_assets = 4 (rep 3/3)    [4/90] Plain (iid): n_assets = 8 (rep 1/3)    [5/90] Plain (iid): n_assets = 8 (rep 2/3)    [6/90] Plain (iid): n_assets = 8 (rep 3/3)    [7/90] Plain (iid): n_assets = 16 (rep 1/3)    [8/90] Plain (iid): n_assets = 16 (rep 2/3)    [9/90] Plain (iid): n_assets = 16 (rep 3/3)    [10/90] Plain (iid): n_assets = 32 (rep 1/3)    [11/90] Plain (iid): n_assets = 32 (rep 2/3)    [12/90] Plain (iid): n_assets = 32 (rep 3/3)    [13/90] Plain (iid): n_assets = 64 (rep 1/3)    [14/90] Plain (iid): n_assets = 64 (rep 2/3)    [15/90] Plain (iid): n_assets = 64 (rep 3/3)    [16/90] Plain (iid): n_assets = 128 (rep 1/3)    [17/90] Plain (iid): n_assets = 128 (rep 2/3)    [18/90] Plain (iid): n_assets = 128 (rep 3/3)    [19/90] Moving Block: n_assets = 4 (rep 1/3)    [20/90] Moving Block: n_assets = 4 (rep 2/3)    [21/90] Moving Block: n_assets = 4 (rep 3/3)    [22/90] Moving Block: n_assets = 8 (rep 1/3)    [23/90] Moving Block: n_assets = 8 (rep 2/3)    [24/90] Moving Block: n_assets = 8 (rep 3/3)    [25/90] Moving Block: n_assets = 16 (rep 1/3)    [26/90] Moving Block: n_assets = 16 (rep 2/3)    [27/90] Moving Block: n_assets = 16 (rep 3/3)    [28/90] Moving Block: n_assets = 32 (rep 1/3)    [29/90] Moving Block: n_assets = 32 (rep 2/3)    [30/90] Moving Block: n_assets = 32 (rep 3/3)    [31/90] Moving Block: n_assets = 64 (rep 1/3)    [32/90] Moving Block: n_assets = 64 (rep 2/3)    [33/90] Moving Block: n_assets = 64 (rep 3/3)    [34/90] Moving Block: n_assets = 128 (rep 1/3)    [35/90] Moving Block: n_assets = 128 (rep 2/3)    [36/90] Moving Block: n_assets = 128 (rep 3/3)    [37/90] Stationary: n_assets = 4 (rep 1/3)    [38/90] Stationary: n_assets = 4 (rep 2/3)    [39/90] Stationary: n_assets = 4 (rep 3/3)    [40/90] Stationary: n_assets = 8 (rep 1/3)    [41/90] Stationary: n_assets = 8 (rep 2/3)    [42/90] Stationary: n_assets = 8 (rep 3/3)    [43/90] Stationary: n_assets = 16 (rep 1/3)    [44/90] Stationary: n_assets = 16 (rep 2/3)    [45/90] Stationary: n_assets = 16 (rep 3/3)    [46/90] Stationary: n_assets = 32 (rep 1/3)    [47/90] Stationary: n_assets = 32 (rep 2/3)    [48/90] Stationary: n_assets = 32 (rep 3/3)    [49/90] Stationary: n_assets = 64 (rep 1/3)    [50/90] Stationary: n_assets = 64 (rep 2/3)    [51/90] Stationary: n_assets = 64 (rep 3/3)    [52/90] Stationary: n_assets = 128 (rep 1/3)    [53/90] Stationary: n_assets = 128 (rep 2/3)    [54/90] Stationary: n_assets = 128 (rep 3/3)    [55/90] HMM: n_assets = 4 (rep 1/3)    converged at iteration 126 with logLik: -1457.335 </span></span>
<span><span class="co">## [56/90] HMM: n_assets = 4 (rep 2/3)    converged at iteration 116 with logLik: -1457.335 </span></span>
<span><span class="co">## [57/90] HMM: n_assets = 4 (rep 3/3)    converged at iteration 139 with logLik: -1457.335 </span></span>
<span><span class="co">## [58/90] HMM: n_assets = 8 (rep 1/3)    converged at iteration 147 with logLik: -2867.839 </span></span>
<span><span class="co">## [59/90] HMM: n_assets = 8 (rep 2/3)    converged at iteration 124 with logLik: -2867.429 </span></span>
<span><span class="co">## [60/90] HMM: n_assets = 8 (rep 3/3)    converged at iteration 133 with logLik: -2867.429 </span></span>
<span><span class="co">## [61/90] HMM: n_assets = 16 (rep 1/3)    converged at iteration 78 with logLik: -5693.949 </span></span>
<span><span class="co">## [62/90] HMM: n_assets = 16 (rep 2/3)    converged at iteration 164 with logLik: -5702.279 </span></span>
<span><span class="co">## [63/90] HMM: n_assets = 16 (rep 3/3)    converged at iteration 75 with logLik: -5693.949 </span></span>
<span><span class="co">## [64/90] HMM: n_assets = 32 (rep 1/3)    converged at iteration 197 with logLik: -11405.85 </span></span>
<span><span class="co">## [65/90] HMM: n_assets = 32 (rep 2/3)    converged at iteration 60 with logLik: -11399.32 </span></span>
<span><span class="co">## [66/90] HMM: n_assets = 32 (rep 3/3)    converged at iteration 135 with logLik: -11405.85 </span></span>
<span><span class="co">## [67/90] HMM: n_assets = 64 (rep 1/3)    converged at iteration 79 with logLik: -22775.09 </span></span>
<span><span class="co">## [68/90] HMM: n_assets = 64 (rep 2/3)    converged at iteration 37 with logLik: -22770.01 </span></span>
<span><span class="co">## [69/90] HMM: n_assets = 64 (rep 3/3)    converged at iteration 112 with logLik: -22770.01 </span></span>
<span><span class="co">## [70/90] HMM: n_assets = 128 (rep 1/3)    converged at iteration 83 with logLik: -45462.6 </span></span>
<span><span class="co">## [71/90] HMM: n_assets = 128 (rep 2/3)    converged at iteration 55 with logLik: -45462.55 </span></span>
<span><span class="co">## [72/90] HMM: n_assets = 128 (rep 3/3)    converged at iteration 165 with logLik: -45478.75 </span></span>
<span><span class="co">## [73/90] Wild: n_assets = 4 (rep 1/3)    [74/90] Wild: n_assets = 4 (rep 2/3)    [75/90] Wild: n_assets = 4 (rep 3/3)    [76/90] Wild: n_assets = 8 (rep 1/3)    [77/90] Wild: n_assets = 8 (rep 2/3)    [78/90] Wild: n_assets = 8 (rep 3/3)    [79/90] Wild: n_assets = 16 (rep 1/3)    [80/90] Wild: n_assets = 16 (rep 2/3)    [81/90] Wild: n_assets = 16 (rep 3/3)    [82/90] Wild: n_assets = 32 (rep 1/3)    [83/90] Wild: n_assets = 32 (rep 2/3)    [84/90] Wild: n_assets = 32 (rep 3/3)    [85/90] Wild: n_assets = 64 (rep 1/3)    [86/90] Wild: n_assets = 64 (rep 2/3)    [87/90] Wild: n_assets = 64 (rep 3/3)    [88/90] Wild: n_assets = 128 (rep 1/3)    [89/90] Wild: n_assets = 128 (rep 2/3)    [90/90] Wild: n_assets = 128 (rep 3/3)</span></span></code></pre>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Display results</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">bench_result</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">bench_result</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Plot</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bench_result</span>, show_ribbon <span class="op">=</span> <span class="cn">FALSE</span>, show_points <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## tsbs Benchmark Results</span></span>
<span><span class="co">## ======================</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Varying parameter: n_assets </span></span>
<span><span class="co">## Values tested: 4, 8, 16, 32, 64, 128 </span></span>
<span><span class="co">## Repetitions per test: 3 </span></span>
<span><span class="co">## Input data dimensions: 252 x 128 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Setups compared:</span></span>
<span><span class="co">##   - Plain (iid) : bs_type = moving, block_length = 1</span></span>
<span><span class="co">##   - Moving Block : bs_type = moving, block_length = 5</span></span>
<span><span class="co">##   - Stationary : bs_type = stationary</span></span>
<span><span class="co">##   - HMM : bs_type = hmm</span></span>
<span><span class="co">##   - Wild : bs_type = wild</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Mean runtime (seconds) by setup and n_assets :</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Value   HMM Moving Block Plain (iid) Stationary   Wild</span></span>
<span><span class="co">##      4 0.344      0.00490     0.00779    0.00526 0.0195</span></span>
<span><span class="co">##      8 0.764      0.00937     0.00803    0.00977 0.0222</span></span>
<span><span class="co">##     16 0.921      0.01498     0.01779    0.01531 0.0281</span></span>
<span><span class="co">##     32 1.959      0.02805     0.03409    0.10052 0.0415</span></span>
<span><span class="co">##     64 2.294      0.12595     0.12711    0.05116 0.0676</span></span>
<span><span class="co">##    128 6.037      0.10349     0.18502    0.17778 0.1925</span></span></code></pre>
<p><img src="portfolio-optimization-demo_files/figure-html/benchmark_run_nassets-1.png" class="r-plt" alt="" width="960"></p>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## BENCHMARK INTERPRETATION</span></span>
<span><span class="co">## -----------------------------------------------------------------------</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Key takeaways:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1. BLOCK METHODS ARE FAST: Plain, Moving Block, and Stationary bootstrap</span></span>
<span><span class="co">##    have nearly identical runtime - the block structure adds minimal overhead.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 2. WILD BOOTSTRAP: Also very fast since it only multiplies by random signs.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 3. LINEAR SCALING: All methods scale roughly linearly with num_boots,</span></span>
<span><span class="co">##    making it easy to estimate runtime for larger analyses.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 4. HMM/MS-VARMA-GARCH: Much slower due to model fitting. Use these when</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##    regime dynamics are important, but be aware of the computational cost.</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 5. PRACTICAL TIP: For exploratory analysis, start with fast methods.</span></span>
<span><span class="co">##    Switch to model-based methods for final results when regime structure matters.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="visualizing-bootstrap-composition">Visualizing Bootstrap Composition<a class="anchor" aria-label="anchor" href="#visualizing-bootstrap-composition"></a>
</h3>
<p>To understand how different bootstrap methods sample from the
original data, we use <code><a href="../reference/plot_regime_composition.html">plot_regime_composition()</a></code> from the
diagnostics system. For regime-switching methods (HMM, MS-VARMA-GARCH),
we can overlay smoothed state probabilities to show regime
uncertainty.</p>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<pre><code><span><span class="co">## BOOTSTRAP COMPOSITION VISUALIZATION</span></span></code></pre>
<pre><code><span><span class="co">## -----------------------------------------------------------------------</span></span></code></pre>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run bootstrap methods with diagnostics enabled for visualization</span></span>
<span><span class="co">## Using a single replicate for clarity</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">num_boots_viz</span> <span class="op">&lt;-</span> <span class="fl">3</span>  <span class="co"># Small number for visualization</span></span>
<span></span>
<span><span class="co">## Helper to create regime bands from rolling volatility</span></span>
<span><span class="va">create_vol_regimes</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">window</span> <span class="op">=</span> <span class="fl">21</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">vol</span> <span class="op">&lt;-</span> <span class="fu">zoo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/rollapply.html" class="external-link">rollapply</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, width <span class="op">=</span> <span class="va">window</span>, FUN <span class="op">=</span> <span class="va">sd</span>, fill <span class="op">=</span> <span class="cn">NA</span>, align <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span>
<span>  <span class="va">vol_median</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">vol</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">regimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">vol</span> <span class="op">&gt;</span> <span class="va">vol_median</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">regimes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">regimes</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>  <span class="va">regimes</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Create regime bands data frame for plotting</span></span>
<span><span class="va">create_regime_bands</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">regimes</span>, <span class="va">label</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rle_reg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rle.html" class="external-link">rle</a></span><span class="op">(</span><span class="va">regimes</span><span class="op">)</span></span>
<span>  <span class="va">ends</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">rle_reg</span><span class="op">$</span><span class="va">lengths</span><span class="op">)</span></span>
<span>  <span class="va">starts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ends</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    xmin <span class="op">=</span> <span class="va">starts</span>,</span>
<span>    xmax <span class="op">=</span> <span class="va">ends</span>,</span>
<span>    Regime <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">rle_reg</span><span class="op">$</span><span class="va">values</span> <span class="op">==</span> <span class="fl">1</span>, <span class="st">"Low Volatility"</span>, <span class="st">"High Volatility"</span><span class="op">)</span>,</span>
<span>    Series <span class="op">=</span> <span class="va">label</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Compute regimes for original data</span></span>
<span><span class="va">orig_regimes</span> <span class="op">&lt;-</span> <span class="fu">create_vol_regimes</span><span class="op">(</span><span class="va">y_compare</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Compute cumulative returns for visualization</span></span>
<span><span class="va">cum_returns</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">r</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">r</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## Storage for plot data</span></span>
<span><span class="va">plot_data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">regime_bands_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Original series</span></span>
<span><span class="va">plot_data_list</span><span class="op">[[</span><span class="st">"Original"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">y_compare</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Value <span class="op">=</span> <span class="fu">cum_returns</span><span class="op">(</span><span class="va">y_compare</span><span class="op">)</span>,</span>
<span>  Series <span class="op">=</span> <span class="st">"Original"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">regime_bands_list</span><span class="op">[[</span><span class="st">"Original"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">create_regime_bands</span><span class="op">(</span><span class="va">orig_regimes</span>, <span class="st">"Original"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## --- Moving Block Bootstrap ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Generating Moving Block visualization...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Generating Moving Block visualization...</span></span></code></pre>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">moving_viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y_compare</span>, bs_type <span class="op">=</span> <span class="st">"moving"</span>, block_length <span class="op">=</span> <span class="fl">10</span>, num_boots <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boot_series</span> <span class="op">&lt;-</span> <span class="va">moving_viz</span><span class="op">$</span><span class="va">bootstrap_series</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">plot_data_list</span><span class="op">[[</span><span class="st">"Moving Block"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Value <span class="op">=</span> <span class="fu">cum_returns</span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span>,</span>
<span>  Series <span class="op">=</span> <span class="st">"Moving Block"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## For block methods, we don't have regime info - use proxy</span></span>
<span><span class="va">boot_regimes</span> <span class="op">&lt;-</span> <span class="fu">create_vol_regimes</span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span></span>
<span><span class="va">regime_bands_list</span><span class="op">[[</span><span class="st">"Moving Block"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">create_regime_bands</span><span class="op">(</span><span class="va">boot_regimes</span>, <span class="st">"Moving Block"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## --- Stationary Bootstrap ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Generating Stationary Block visualization...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Generating Stationary Block visualization...</span></span></code></pre>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stat_viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y_compare</span>, bs_type <span class="op">=</span> <span class="st">"stationary"</span>, num_boots <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boot_series</span> <span class="op">&lt;-</span> <span class="va">stat_viz</span><span class="op">$</span><span class="va">bootstrap_series</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">plot_data_list</span><span class="op">[[</span><span class="st">"Stationary"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Value <span class="op">=</span> <span class="fu">cum_returns</span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span>,</span>
<span>  Series <span class="op">=</span> <span class="st">"Stationary"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">boot_regimes</span> <span class="op">&lt;-</span> <span class="fu">create_vol_regimes</span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span></span>
<span><span class="va">regime_bands_list</span><span class="op">[[</span><span class="st">"Stationary"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">create_regime_bands</span><span class="op">(</span><span class="va">boot_regimes</span>, <span class="st">"Stationary"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## --- HMM Bootstrap (with actual fitted regimes) ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Generating HMM visualization...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Generating HMM visualization...</span></span></code></pre>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_viz</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y_compare</span>, bs_type <span class="op">=</span> <span class="st">"hmm"</span>, num_states <span class="op">=</span> <span class="fl">2</span>, num_boots <span class="op">=</span> <span class="fl">1</span>, return_fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## converged at iteration 33 with logLik: -1084.145</span></span></code></pre>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">hmm_viz</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">boot_series</span> <span class="op">&lt;-</span> <span class="va">hmm_viz</span><span class="op">$</span><span class="va">bootstrap_series</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">plot_data_list</span><span class="op">[[</span><span class="st">"HMM"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    Index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    Value <span class="op">=</span> <span class="fu">cum_returns</span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span>,</span>
<span>    Series <span class="op">=</span> <span class="st">"HMM"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Use actual fitted states if available</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">hmm_viz</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">fitted_states</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">depmixS4</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/depmixS4/man/posterior.html" class="external-link">posterior</a></span><span class="op">(</span><span class="va">hmm_viz</span><span class="op">$</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"viterbi"</span><span class="op">)</span><span class="op">$</span><span class="va">state</span></span>
<span>    <span class="op">}</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="fu">create_vol_regimes</span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">fitted_states</span> <span class="op">&lt;-</span> <span class="fu">create_vol_regimes</span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">regime_bands_list</span><span class="op">[[</span><span class="st">"HMM"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">create_regime_bands</span><span class="op">(</span><span class="va">fitted_states</span>, <span class="st">"HMM"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co">## --- Wild Bootstrap ---</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Generating Wild Bootstrap visualization...\n"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Generating Wild Bootstrap visualization...</span></span></code></pre>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wild_viz</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tsbs.html">tsbs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">y_compare</span>, bs_type <span class="op">=</span> <span class="st">"wild"</span>, num_boots <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boot_series</span> <span class="op">&lt;-</span> <span class="va">wild_viz</span><span class="op">$</span><span class="va">bootstrap_series</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">plot_data_list</span><span class="op">[[</span><span class="st">"Wild"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Value <span class="op">=</span> <span class="fu">cum_returns</span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span>,</span>
<span>  Series <span class="op">=</span> <span class="st">"Wild"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">boot_regimes</span> <span class="op">&lt;-</span> <span class="fu">create_vol_regimes</span><span class="op">(</span><span class="va">boot_series</span><span class="op">)</span></span>
<span><span class="va">regime_bands_list</span><span class="op">[[</span><span class="st">"Wild"</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">create_regime_bands</span><span class="op">(</span><span class="va">boot_regimes</span>, <span class="st">"Wild"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Combine all data</span></span>
<span><span class="va">plot_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">plot_data_list</span><span class="op">)</span></span>
<span><span class="va">regime_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">regime_bands_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Set factor order</span></span>
<span><span class="va">series_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Original"</span>, <span class="st">"Moving Block"</span>, <span class="st">"Stationary"</span>, <span class="st">"HMM"</span>, <span class="st">"Wild"</span><span class="op">)</span></span>
<span><span class="va">plot_df</span><span class="op">$</span><span class="va">Series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plot_df</span><span class="op">$</span><span class="va">Series</span>, levels <span class="op">=</span> <span class="va">series_order</span><span class="op">)</span></span>
<span><span class="va">regime_df</span><span class="op">$</span><span class="va">Series</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">regime_df</span><span class="op">$</span><span class="va">Series</span>, levels <span class="op">=</span> <span class="va">series_order</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create the plot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_composition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## Regime bands</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">regime_df</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">xmin</span>, xmax <span class="op">=</span> <span class="va">xmax</span>, ymin <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, ymax <span class="op">=</span> <span class="cn">Inf</span>, fill <span class="op">=</span> <span class="va">Regime</span><span class="op">)</span>,</span>
<span>            alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## Price lines</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">plot_df</span>,</span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Index</span>, y <span class="op">=</span> <span class="va">Value</span><span class="op">)</span>,</span>
<span>            color <span class="op">=</span> <span class="st">"black"</span>, linewidth <span class="op">=</span> <span class="fl">0.4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## Facet</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Series</span>, ncol <span class="op">=</span> <span class="fl">1</span>, scales <span class="op">=</span> <span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## Colors</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low Volatility"</span> <span class="op">=</span> <span class="st">"lightblue"</span>, </span>
<span>                                <span class="st">"High Volatility"</span> <span class="op">=</span> <span class="st">"salmon"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co">## Labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Bootstrap Composition: Original vs. Resampled Series"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Colored bands show volatility regimes (estimated from rolling volatility)"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">"Time Index"</span>,</span>
<span>       y <span class="op">=</span> <span class="st">"Cumulative Value (%)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    strip.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span>, size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_composition</span><span class="op">)</span></span></code></pre></div>
<p><img src="portfolio-optimization-demo_files/figure-html/regime_composition_plots-1.png" class="r-plt" alt="" width="1152"></p>
<pre><code><span><span class="co">## --- Interpretation ---</span></span></code></pre>
<pre><code><span><span class="co">## The plot above shows how different bootstrap methods resample the original series:</span></span></code></pre>
<pre><code><span><span class="co">## - ORIGINAL: The actual return series with volatility-based regime classification</span></span></code></pre>
<pre><code><span><span class="co">## - MOVING BLOCK: Resamples contiguous 10-day blocks, preserving local structure</span></span></code></pre>
<pre><code><span><span class="co">##   but potentially creating artificial regime transitions at block boundaries</span></span></code></pre>
<pre><code><span><span class="co">## - STATIONARY: Similar to moving block but with random (geometric) block lengths,</span></span></code></pre>
<pre><code><span><span class="co">##   providing some variability in the dependence structure captured</span></span></code></pre>
<pre><code><span><span class="co">## - HMM: Uses fitted Hidden Markov Model to identify regimes, then resamples</span></span></code></pre>
<pre><code><span><span class="co">##   entire regime blocks. This preserves within-regime dynamics better.</span></span></code></pre>
<pre><code><span><span class="co">## - WILD: Multiplies each observation by +1 or -1, preserving magnitude structure</span></span></code></pre>
<pre><code><span><span class="co">##   but randomizing signs. Note: regime patterns still visible from magnitudes.</span></span></code></pre>
<pre><code><span><span class="co">## Key insight: Regime-based methods (HMM, MS-VARMA-GARCH) are designed to preserve</span></span></code></pre>
<pre><code><span><span class="co">## the regime structure, while block methods may inadvertently mix observations</span></span></code></pre>
<pre><code><span><span class="co">## from different regimes.</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This vignette demonstrated:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Multi-model comparison</strong>: DCC, CGARCH, and GOGARCH
each provide different perspectives on correlation dynamics and
portfolio uncertainty.</p></li>
<li>
<p><strong>Bootstrap diagnostics system</strong>: The
<code>tsbs</code> package’s <code>tsbs_diagnostics</code> class provides
comprehensive tools for analyzing bootstrap quality:</p>
<ul>
<li>
<code><a href="../reference/compute_bootstrap_diagnostics.html">compute_bootstrap_diagnostics()</a></code> for post-hoc
analysis</li>
<li>
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> methods for
visualization</li>
<li>
<code><a href="../reference/extract_blocks.html">extract_blocks()</a></code> and
<code><a href="../reference/extract_summary_stats.html">extract_summary_stats()</a></code> for programmatic access</li>
</ul>
</li>
<li><p><strong>Practical portfolio optimization</strong>: Six strategies
were compared using real market data with quarterly
rebalancing.</p></li>
<li><p><strong>Uncertainty quantification</strong>: Bootstrap methods
reveal substantial uncertainty in optimal weights, which should inform
allocation decisions.</p></li>
<li>
<p><strong>Bootstrap method comparison</strong>: Different bootstrap
approaches produce different uncertainty estimates:</p>
<ul>
<li>Block methods (moving, stationary) are fast but may mix regimes</li>
<li>Regime methods (HMM, MS-VARMA-GARCH) preserve dynamics at higher
cost</li>
<li>Wild bootstrap handles heteroskedasticity</li>
</ul>
</li>
<li><p><strong>Composition visualization</strong>:
<code><a href="../reference/plot_regime_composition.html">plot_regime_composition()</a></code> reveals how each method samples
from the original data, helping users understand the implications of
their method choice.</p></li>
<li><p><strong>Runtime considerations</strong>: The
<code><a href="../reference/benchmark_tsbs.html">benchmark_tsbs()</a></code> utility helps choose methods based on
computational constraints.</p></li>
</ol>
<p>For more details on the underlying models, see: - <code><a href="../reference/tsbs.html">?tsbs</a></code>
for the main bootstrap interface -
<code><a href="../reference/compute_bootstrap_diagnostics.html">?compute_bootstrap_diagnostics</a></code> for the diagnostics system -
<code><a href="../reference/plot.tsbs_diagnostics.html">?plot.tsbs_diagnostics</a></code> for diagnostic visualization -
<code><a href="../reference/extract_blocks.html">?extract_blocks</a></code> and <code><a href="../reference/extract_summary_stats.html">?extract_summary_stats</a></code> for
data extraction - <code><a href="../reference/benchmark_tsbs.html">?benchmark_tsbs</a></code> for runtime
benchmarking</p>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<pre><code><span><span class="co">## SESSION INFO</span></span></code></pre>
<pre><code><span><span class="co">## =======================================================================</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Vignette completed at: 2026-01-28 14:52:19</span></span></code></pre>
<pre><code><span><span class="co">## R version: R version 4.5.2 (2025-10-31)</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Hoshi Vognsen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
